<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>







  <meta content="text/html; charset=us-ascii" http-equiv="content-type">







  <title>Mpm Quick Reference Guide</title>
</head>


<body>




<div style="text-align: center; font-weight: bold;"><big>[M]ultiple [P]rocessor
[M]odule Assembler - Z80 Edition V1.2, 2006<br>




Quick Reference Guide (draft)</big></div>




<br>




<hr style="width: 100%; height: 2px;">
Copyright (C) 1991-2006, Gunther Strube, gbs@users.sf.net<br>




<br>




This file is part of Mpm. Mpm is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License as published by the
Free Software Foundation; either version 2, or (at your option) any later
version. Mpm is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU General Public License for more details. You
should have received a copy of the GNU General Public License along with Mpm;
see the file COPYING. If not, write to the Free Software Foundation, Inc., 59
Temple Place - Suite 330, Boston, MA 02111-1307, USA.<br>




<hr style="width: 100%; height: 2px;">
<br>




<div style="text-align: center;"><big><span style="font-weight: bold;">Contents</span></big></div>




<div style="text-align: left;">
<ol>




  <li><a href="#cmdline">Instructing the assembler on the command line</a>



    <ul>




      <li><a href="#options_nopar">Options without parameters</a></li>




      <li><a href="#options_par">Options with parameters</a></li>







    </ul>




  </li>




  <li><a href="#envvar">Environment variables</a></li>




  <li><a href="#filetypes">MPM module assembler file types</a></li>




  <li><a href="#platformid">The standard platform identifier</a></li>




  <li><a href="#sourcefile">Source file structure and layout</a></li>




  <li><a href="#comments">Comments in source files</a></li>




  <li><a href="#labels">Defining symbolic address labels</a></li>




  <li><a href="#expressions">Using expressions</a>



    <ul>




      <li><a href="#numconsts">Numeric constants</a></li>




      <li><a href="#arithop">Arithmetic operators</a></li>




      <li><a href="#hashop">The # operator</a></li>




      <li><a href="#relop">Relational operators</a></li>




      <li><a href="#asmpc">Predefined assembler variables</a></li>







    </ul>




  </li>




  <li><a href="#directiveref">Directive reference</a>



    <ul>




      <li><a href="#align">ALIGN</a></li>




      <li><a href="#defm">ASCII, ASCIIZ, DM, DMZ,&nbsp;DEFM, DEFMZ</a></li>




      <li><a href="#byte">BYTE, DB, DEFB</a></li>




      <li><a href="#calloz">CALL_OZ, OZ</a></li>




      <li><a href="#call_pkg">CALL_PKG</a></li>




      <li><a href="#defc">DC, DEFC</a></li>




      <li><a href="#defgroup">DEFGROUP, ENUM</a></li>




      <li><a href="#define">DEFINE, DEFSYM, UNDEFINE</a></li>




      <li><a href="#defl">DEFL, LONG</a></li>




      <li><a href="#defp">DEFP, DP</a></li>




      <li><a href="#defs">DEFS, DS, SPACE</a></li>




      <li><a href="#defvars">DEFVARS, DV</a></li>




      <li><a href="#error">ERROR</a></li>




      <li><a href="#extcall">EXTCALL</a></li>




      <li><a href="#extern">EXTERN, XREF</a></li>




      <li><a href="#fpp">FPP</a></li>




      <li><a href="#global">GLOBAL, XDEF</a></li>




      <li><a href="#if">IF, ELSE, ENDIF</a></li>




      <li><a href="#include">INCLUDE</a></li>







    </ul>




  </li>




</ol>




</div>




<br>




<hr style="width: 100%; height: 2px;">
<br>




<br>




<big><a name="cmdline" id="cmdline"></a><span style="font-weight: bold;">Instructing the assembler on the command
line</span></big><br>




Mpm is executed using the operating system standard command line environment
(CLI).
<p>When executing the assembler from the command line without options, i.e.
<span style="font-family: monospace;">mpm&lt;ENTER&gt;</span>, a help page is
automatically displayed where after control is returned to the operating system
command line. The page shortly explains the syntax of option specification and
which options are available.</p>




<p>The syntax of the assembler options is a straightforward design. Filenames
or a project file are always specified. The options may be left out (surrounded
here with []):&nbsp;</p>




<span style="font-family: monospace;">mpm [<span style="font-weight: bold;">-</span>options]&nbsp;{filenames}
|&nbsp;@projectfile</span>
<p>As seen above&nbsp;<span style="font-family: monospace;">[-options]</span>
must be specified first, followed by the names of assembler source files. You
either choose to specify all file names or a <span style="font-family: monospace;">@&lt;projectfile&gt;</span> containing all file
names. Filenames may be specified with or without the .asm filename extension.
At least on source file must be specified and may be repeated with several file
names. Only one project file may be specified if no source file names are
given. You may use comment lines inside projects files using
semicolon.&nbsp;</p>




<p>Options are used to control the assembly process and output. They are
recognized by the assembler when you specify a leading minus before the option
identifier ('-'). When the assembler is executed options are all preset with
default values and are either switched ON or OFF (active or not).&nbsp;</p>




<p>Upper and lower case letters are distinguished, which means that 'a' is a
different command than 'A'. If an option is to be turned off, a 'n' is
specified before the identification, e.g. <span style="font-family: monospace;">-nl</span>. Single letter options without parameters
can be concatanated in a single option block. Default options are: <span style="font-weight: bold; font-family: monospace;">-sm -nvadbctgA</span></p>




<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr align="center">




      <td colspan="2"><span style="font-style: italic;"><a name="options_nopar" id="options_nopar"></a><span style="font-weight: bold;">Options without
parameters</span></span></td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-v</span></td>




      <td>Verbose output during assembly. Not enabled by default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-t</span></td>




      <td>Create listing file output. Listing file contains generated machine code
output combined with source code lines and optionally a symbol table. Not
enabled by default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top; font-family: monospace;">-s</td>




      <td>Create symbol table in listing file, or if no listing file
enabled - then create a standalone symbol table file. Enabled by
default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-m</span></td>




      <td>Create address map information file (only when performing linking of object
files&nbsp;).&nbsp;Enabled by default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top; font-family: monospace;">-d</td>




      <td>Assemble only updated source files.&nbsp;Not enabled by default (always
compile even if object file exists).</td>




    </tr>




    <tr>




      <td style="vertical-align: top; font-family: monospace;">-b</td>




      <td>Link object files into executable binary. Not enabled by default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-a</span></td>




      <td>Assemble only updated source files and automatically link object files into
executable binary.&nbsp;Not enabled by default.</td>




    </tr>




    <tr>




      <td><span style="font-family: monospace;">-c</span></td>




      <td>Split linked executable&nbsp;into 16K binary files (using .bnX extension).
Not enabled by default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top; font-family: monospace;">-g</td>




      <td>Create global address definition file (dump all referenced XREF names). Not
enabled by default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-A</span></td>




      <td>Address align DEFW &amp; DEFL constants. Not enabled by default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-C</span></td>




      <td>Override compile error/warnings line numbers using external source code
line number reference (specify external line numbers with LINE directive in
souce code). Implemented as "C line mode" when Mpm functions as back end for
z88dk C compiler. Not enabled by default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-R</span></td>




      <td>Generate address independent executable binary (code needs to run in RAM).
Not enabled by default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-plus</span></td>




      <td>INVOKE directive generates&nbsp;RST 28H instruction opcode (otherwise CALL
instruction). Not enabled by default.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-IXIY</span></td>




      <td>All IY related instructions are generated with IX instruction opcodes and
vice versa. Not enabled by default.</td>




    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-crc32</span></td>

      <td>Creates a *.crc file that contains the CRC32 (32bit) hexadecimal value of the compiled binary. Not enabled by default.</td>

    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr align="center">




      <td colspan="2"><span style="font-style: italic;"><a name="options_par" id="options_par"></a><span style="font-weight: bold;">Options with
parameters</span></span></td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-D&lt;symbol&nbsp;name&gt;</span></td>




      <td>Define symbol name as logically TRUE and available for current compilation
session.<br>



      </td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-r&lt;address&gt;</span></td>




      <td>Re-define the ORG linking executable start address (override ORG directive
in first&nbsp; source code file).</td>




    </tr>




    <tr>




      <td style="vertical-align: top; font-family: monospace;">-e&lt;ext&gt;</td>




      <td>Replace default "asm" input source file name extension
with&nbsp;&lt;ext&gt;. Max 3 letters (specified without ".")</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-M&lt;ext&gt;</span></td>




      <td>Replace default "obj" filename extension for output object module files
with &lt;ext&gt;. Max 3 letters (specified without ".")</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-o&lt;filename&gt;</span></td>




      <td>Override generated executable binary&nbsp;default filename with
&lt;filename&gt;. The &nbsp;default filename is derived from the first
specified source filename or derived from the project filename. Also requires
-b or -a option (to create a linked executable binary).<br>



      </td>




    </tr>




    <tr>




      <td style="vertical-align: top; font-family: monospace;"><a name="include_searchpath" id="include_searchpath"></a> -I&lt;path&gt;</td>




      <td>add <span style="font-family: monospace;">INCLUDE</span> directive search
path&nbsp;(relative paths names are allowed). Several paths may be concanated
by using operating system path separator (';' in Windows, ':' in Unix). Avoid
space between the path and the separator.<br>




-I option may be specified multiply times at command line.<br>



      </td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">-L&lt;path&gt;</span></td>




      <td>add <span style="font-family: monospace;">LIB</span> library file search
path&nbsp;(relative paths are allowed).&nbsp;Several paths may be concanated by
using operating system path separator (';' in Windows, ':' in Unix). Avoid
space between the path and the separator.<br>




-L option may be specified multiply times at command line.</td>




    </tr>




    <tr>




      <td><span style="font-family: monospace;">-x&lt;filename&gt;</span></td>




      <td>Create library file from specified modules. Use with a @projectfile
specification for convenience. Using -b or -a with this option is
meaningless.<br>



      </td>




    </tr>




    <tr>




      <td style="vertical-align: top; font-family: monospace;">
-l&lt;filename&gt;</td>




      <td>Statically link found library modules in specified library file, which is
appended to compiled code that used the LIB directive. Paths in filename is
optional.&nbsp;May be combined with the -L option (to search for library at
search paths).<br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<big><a name="envvar" id="envvar"></a><span style="font-weight: bold;">Environment variables</span></big><br>




The assembler looks into the operating system environment for these
three&nbsp;variables. Convenient for shell scripts where the environment
variables are instantiated for use while the shell is open:<br>




<br>




<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="vertical-align: top; font-family: monospace;">
MPM_Z80_INCLUDEPATH</td>




      <td>Defines the default path of header/include definition files. Multiple paths
may specifed using operating system specific path separator (see options
above). Equivalent to the -I option</td>




    </tr>




    <tr>




      <td style="vertical-align: top; font-family: monospace;">MPM_Z80_LIBPATH</td>




      <td>Defines the default seach path for Mpm library files. Multiple paths may
specifed.&nbsp;Multiple paths may specifed using operating system specific path
separator (see options above). Equivalent to the -L option.</td>




    </tr>




    <tr>




      <td style="vertical-align: top; font-family: monospace;">
MPM_Z80_STDLIBRARY</td>




      <td>Defines the default filename of the standard library to be scanned by LIB
directives.</td>




    </tr>







  </tbody>
</table>




<br>




<br>




<big><a name="filetypes" id="filetypes"></a><span style="font-weight: bold;">MPM module assembler file types</span></big><br>




The MPM Module Assembler uses several different file name extensions to
distinguish the type of files processed and generated. All extensions are using
three letter combinations. All generated files will replace the 'asm' extension
with the appropriate default output extension (keeping remaining input filename
intact).<br>




<br>




<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="font-family: monospace;">asm</td>




      <td>The source file (input) extension. May be overridden using the -e
option.</td>




    </tr>




    <tr>




      <td style="vertical-align: top; font-family: monospace;">obj</td>




      <td>The generated object module extension. The file contains intermediate
generated machine code, optional address origin, symbols and
expressions.&nbsp;May be overridden using the -M option.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">err</span></td>




      <td>Error reporting files. If any errors should occur, they will be written to
this file containing information of where the error occurred in the
corresponding source file.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">lst</span></td>




      <td>Listing file. This file contains a hexadecimal output column of the
generated machine code that corresponds to the Z80 mnemonic instruction or
directive, followed by a copy of the original source code, line by line. A
symbol table is dumped at the end of the listing file.</td>




    </tr>




    <tr>



      <td style="vertical-align: top;"><span style="font-family: monospace;">sym</span></td>



      <td>Symbol Table file. This file contains a symbol name and hexadecimal value
output columns of the
found and used symbol definitions in the sources. The symbol table file
is automatically generated if no listing file was enabled. This file is
generated by default.</td>



    </tr>



    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">bin</span></td>




      <td>The final output file containing the executable linked and address
relocated object modules. The complete filename (including extension) may be
overridden using the -o option.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">map</span></td>




      <td>This file contains a list of all defined address labels from all
linked/relocated modules (and optionally LIB modules) with their calculated
(absolute) address when the code is loaded into the executing memory
environment. All labels are sorted in two sections; first by&nbsp;name, then by
address, both in ascending order.</td>




    </tr>




    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">crc</span></td>

      <td>This file contains a calculated CRC32 hexadecimal value of
the final executable output file. It is only generated if you use the <span style="font-family: monospace;">-crc32</span> command line option.</td>

    </tr>

    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">def</span></td>




      <td>This file contains a DEFC directive list of all globally declared address
labels with their calculated (absolute) origin address, fetched only during
assembly of source file modules. The file may be useful for cross referencing
in separate compile projects.</td>




    </tr>




    <tr>




      <td style="vertical-align: top;"><span style="font-family: monospace;">lib</span></td>




      <td>Library file, which may be created using the -x option. Library modules may
be included into application code during linking of object modules using the -l
option.</td>




    </tr>







  </tbody>
</table>




<br>




<br>




<big><a name="platformid" id="platformid"></a><span style="font-weight: bold;">The standard platform identifier</span></big> When the MPM
Assembler is running, a standard platform identifier (with value 1) is made
available when typically using IF directives or other expressions. The
identifier reflects the name of the platform:<br>




<br>




"MSDOS" - the assembler is running on the MS-DOS or Windows&nbsp;platform of
computers<br>




"UNIX" - the assembler is running on the LINUX/UNIX/MAC OSX platform.<br>




<br>




The identifier might be very handy when you need to port your source files to
different computer platforms.<br>




<br>




<br>




<big><a name="sourcefile" id="sourcefile"></a><span style="font-weight: bold;">Source file structure and layout</span></big><br>




The composition of a source file module is completely free to the programmer.
How he chooses to place the source code on a text line has no effect of the
parsing process of the assembler. The linefeed interpretation is also handled
by MPM - it understands all known line ending formats:<br>




<br>




<span style="font-family: monospace;">&lt;LF&gt;</span> (used
by&nbsp;UNIX/AMIGA/MAC OS X)<br>




<span style="font-family: monospace;">&lt;CR&gt;&lt;LF&gt;</span> (used by
MSDOS, WINDOWS)<br>




<span style="font-family: monospace;">&lt;CR&gt;</span> (used by Z88, Mac
OS&nbsp;8/9)<br>




<br>




Each source file begins with a MODULE definition, then optionally an ORG
directive followed by INCLUDE directives (importing constant definitions). Also
appropriate is to specify all global and external&nbsp;identifiers (for
cross-module referencing) at the top of the source file, using the XDEF and
XREF directives. Good practice is also to specify in which module (file) the
XREF identifier is created (where it is XDEF'ined). The rest of the file
contains the actual code or data.<br>




<br>




<br>




<big><a name="comments" id="comments"></a><span style="font-weight: bold;">Comments in source files</span></big><br>




Comments in Z80 source files are added using a semicolon, followed by the text
of the comment. When the assembler meets a semicolon the rest of the current
source line is ignored until the linefeed. The semicolon may be placed anywhere
in a source line. The following is an example on how to use comments in Z80
source files:<br>




<br>




<span style="font-family: monospace;">; **********************</span><br style="font-family: monospace;">




<span style="font-family: monospace;">; main menu</span><br style="font-family: monospace;">




<span style="font-family: monospace;">;</span><br style="font-family: monospace;">




<span style="font-family: monospace;">mainmenu: xor a</span><br style="font-family: monospace;">




<span style="font-family: monospace;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;ret&nbsp;&nbsp;&nbsp; ; back to calling routine...</span><br style="font-family: monospace;">




<br>




<br>




<big><a name="labels" id="labels"></a><span style="font-weight: bold;">Defining
symbolic address labels</span></big> The main reason for using an assembler is
to be able to determine symbolical addresses and use them as reference in the
code, instead of absolute addresses. These are defined by a name preceded with
a full stop or ending with a colon. It is allowed to place an instruction
mnemonic or directive after an address label on the same line. An address label
may be left as a single statement on a line - you may of course use comment
after the label:<br>




<br>




<span style="font-family: monospace;">mainmenu: &nbsp; xor a</span><br style="font-family: monospace;">




<span style="font-family: monospace;">.mainmenu2 &nbsp;; another
comment</span><br style="font-family: monospace;">




<br>




It is not allowed to position two label definitions on the same line. However,
you may place as many label definitions after each other on separate lines -
even though no code is between them. They just receive the same assembler
address during compilation. It is not possible to use two identical address
labels in the same source file. All labels and constant names are case
insensitive.<br>




<br>




<br>




<big><a name="expressions" id="expressions"></a><span style="font-weight: bold;">Using expressions</span></big><br>




Expressions is a necessary tool in source files. They define and explain things
much clearer than just magic numbers. The MPM Module Assembler allows
expressions wherever a parameter is needed, even when a constant is defined.
This applies to Z80 mnemonic instructions, directives and even in character
strings. The resulting value from an evaluated expression is always an integer.
All expressions are calculated&nbsp;as 32 bit signed integers. However, the
parameter type defines the true range of the expression. For example, you
cannot store a 32 bit signed integer in an 8 bit LD instruction like LD
A,&nbsp;n.&nbsp;<br>




<br>




If a parameter is outside an allowed integer range an assemble error is
reported. Expressions may be formed as arithmetic and relational expressions.
Several components are supported: symbol names (identifiers), constants, ASCII
characters and all the usual suspects of arithmetic operators.<br>




<br>




<big><br>




<a name="numconsts" id="numconsts"></a><span style="font-weight: bold;">Numeric
constants</span></big> Apart from specifying decimal integer numbers, you are
allowed to use hexadecimal constants, binary constants and ASCII characters.
The following definitions are available:<br>




<br>




Digits without leading or trailing specifiers are interpreted as decimal
constants.<br>




<br>




<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td>Decimal</td>




      <td>456567,&nbsp;456d</td>




    </tr>




    <tr>




      <td>Hexadecimal</td>




      <td>0xC000 (49152), or 4000h</td>




    </tr>




    <tr>




      <td>Binary</td>




      <td>@11000000 (192d) or 1011b (11d)</td>




    </tr>




    <tr>




      <td>Ascii</td>




      <td>'A' (65d)</td>




    </tr>







  </tbody>
</table>




<br>




<big><a name="arithop" id="arithop"></a><span style="font-weight: bold;">Arithmetic operators</span></big><br>




All basic arithmetic operators are supported. The following table shows them
all. Result of example is shown in brackets for clarity of operator.<br>




<br>




<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td><span style="font-style: italic; font-weight: bold;">Operator
symbol</span></td>




      <td style="font-style: italic;"><span style="font-weight: bold;">Function</span></td>




      <td><span style="font-style: italic; font-weight: bold;">Example</span></td>




    </tr>




    <tr>




      <td>+</td>




      <td>Addition</td>




      <td>12+13</td>




    </tr>




    <tr>




      <td>-</td>




      <td>Unary minus, subtraction &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</td>




      <td>-10, 12 - 45 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</td>




    </tr>




    <tr>




      <td>*</td>




      <td>Multiplication</td>




      <td>45 * 2 (90)</td>




    </tr>




    <tr>




      <td>/</td>




      <td>Division</td>




      <td>256 / 8 (32)</td>




    </tr>




    <tr>




      <td>&gt;</td>




      <td>Unary division by 256</td>




      <td>&gt;1024 (4)</td>




    </tr>




    <tr>




      <td>%</td>




      <td>Modulus</td>




      <td>256%8 (0)</td>




    </tr>




    <tr>




      <td>&lt;</td>




      <td>Unary modulus by 256</td>




      <td>&lt;65000 (232)</td>




    </tr>




    <tr>




      <td>**</td>




      <td>Power</td>




      <td>2 ** 7 (128)</td>




    </tr>




    <tr>




      <td>&amp;</td>




      <td>Binary AND</td>




      <td>255 &amp; 7 (7)</td>




    </tr>




    <tr>




      <td>|</td>




      <td>Binary OR</td>




      <td>128 | 64 (192)</td>




    </tr>




    <tr>




      <td>:</td>




      <td>Binary NOR</td>




      <td>128 : 128 (0)</td>




    </tr>




    <tr>




      <td>^</td>




      <td>Binary XOR</td>




      <td>12 ^ 3 (15)</td>




    </tr>




    <tr>




      <td>~</td>




      <td>Unary Binary NOT</td>




      <td>~128 (127)</td>




    </tr>




    <tr>




      <td>&lt;&lt;</td>




      <td>Binary left shift</td>




      <td>2 &lt;&lt; 4 (32)</td>




    </tr>




    <tr>




      <td>&gt;&gt;</td>




      <td>Binary right shift</td>




      <td>128 &gt;&gt; 4 (8)</td>




    </tr>







  </tbody>
</table>




<br>




Arithmetic operators use the standard operator precedence, shown from highest
to lowest:<br>




<br>




<span style="font-family: monospace;">0x @ '</span> (constant identifiers)<br>




<span style="font-family: monospace;">() []</span><br style="font-family: monospace;">




<span style="font-family: monospace;">~ &gt; &lt;</span><br style="font-family: monospace;">




<span style="font-family: monospace;">**</span><br style="font-family: monospace;">




<span style="font-family: monospace;">* / %</span><br style="font-family: monospace;">




<span style="font-family: monospace;">+- | ^ &amp; : &lt;&lt;
&gt;&gt;</span><br>




<br>




If you want to override the default operator precedence rules, use brackets ()
or []. The square bracket have been implemented as an alternative to avoid
ambiguity with Z80 instruction mnemonics where indirect addressing uses the ()
as part of their syntax.<br>




<br>




<br>




<big><a name="hashop" id="hashop"></a><span style="font-weight: bold;">The #
operator</span></big><br>




This is not a real operator, though. It is only used as the first symbol in an
expression to identify that this expression evaluates to a constant, i.e.
containing no relocatable information. This feature may be necessary when you
have to calculate a distance between two address labels without letting the
assembler think it is a relocatable address. The assembler thinks that
expressions containing address labels are relocatable items, which would create
unwanted side effects during&nbsp;linking of object modules. However, since the
assembler cannot see this as a constant expression, you have to force it as
one.<br>




<br>




<span style="font-family: monospace;">LD BC, end_relocator-relocator</span>
;&nbsp; Mpm adds an ORG constant during linking<br>




<span style="font-family: monospace;">LD BC, #end_relocator-relocator</span> ;
Mpm&nbsp;sees a constant expression<br>




<br>




<br>




<big><a name="relop" id="relop"></a><span style="font-weight: bold;">Relational
operators</span></big><br>




With relational operators you may form logical expressions resulting in true or
false conditions. The resulting value of a true expression is 1. The resulting
value of a false expression is 0. These operators are quite handy when you need
to perform complex logic for conditional assembly in IF-ELSE-ENDIF conditional
assembly. The following relational operators are available:<br>




<br>




<span style="font-family: monospace;">=</span> equal to<br>




<span style="font-family: monospace;">&lt;&gt;</span> not equal to<br>




<span style="font-family: monospace;">&lt;</span> less than<br>




<span style="font-family: monospace;">&gt;</span> larger than<br>




<span style="font-family: monospace;">&lt;=</span> less than or equal to<br>




<span style="font-family: monospace; font-weight: bold;">&gt;=</span> larger
than or equal to<br>




! not<br>




<br>




You may link several relational expressions with the binary operators AND, OR,
XOR and NOT.<br>




It is perfectly legal to use relational expressions in parameters requiring an
arithmetic value. For example:<br>




<br>




<span style="font-family: monospace;">LD A, [USING_IBM = 1] |
RTMFLAGS&nbsp;&nbsp;&nbsp;</span> ; use [] to ensure LD A,n instruction
opcode<br>




<br>




<br>




<big><a name="asmpc" id="asmpc"></a><span style="font-weight: bold;">Predefined assembler variables</span>&nbsp;</big><br>
Apart from declaring your own constants, Mpm has a few pre-declared constants that might become useful in your programs.<br>
<br>
On occasional circumstances it may be necessary to use the current location of
the assembler program counter in an expression e.g. calculating a relative
distance. This may be done with the help of the <span style="font-family: monospace;">$PC</span> identifier. An example:<br>




<br>




<span style="font-family: monospace;">errmsg0: DEFM errmsg1 - $pc - 1, "File
open error"</span><br style="font-family: monospace;">




<span style="font-family: monospace;">errmsg1: DEFM errmsg2 - $pc - 1, "Syntax
error"</span><br style="font-family: monospace;">




<span style="font-family: monospace;">errmsg2:</span><br>




<br>




Here, a length byte of the following string (excluding the length byte) is
calculated by using the current $PC address value.<br>
<br>
When Mpm is starting a compile session, the system clock is fetched once and made available as integer variables:<br>
<br>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td><span style="font-family: monospace;">$YEAR</span></td>
      <td>4-digit year value,&nbsp; eg. 2006</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">$MONTH</span></td>
      <td>Month of the year, range is 1 to 12.</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">$DAY</span></td>
      <td>The day of the month, range is 1-31.</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">$HOUR</span></td>
      <td>Range is 0-23.</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">$MINUTE</span></td>
      <td>Range is 0-59.</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">$SECOND</span></td>
      <td>Range is 0-59.</td>
    </tr>
  </tbody>
</table>
<br>




<br>




<br>




<big><big><b><a name="directiveref" id="directiveref">Directive
reference</a></b></big></big><br>




The MPM Module Assembler directives are used to manipulate the Z80 assembler
mnemonics, generate data structures, variables and constants - even including
binary files while code generation is performed.<br>




<br>




As the name imply they direct the assembler to perform other tasks than just
parsing and compiling Z80 instruction mnemonics. All directives are treated as
mnemonics by the assembler, i.e. it is necessary that they appear as the first
command identifier on the source line (NOT necessarily the first character).
Only one directive is allowed per single source line. As with Z80 mnemonics,
directives are case insensitive.<br>




<br>




The following syntax is used to describe the directives:<br>




<br>




&lt;&gt; defines a syntactic entity, i.e. a number, character or string.<br>




{} defines a repetition of a syntactic entity.<br>




[] defines an option that may be left out.<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold; font-family: monospace;"><a name="align" id="align"></a>ALIGN &lt;no of bytes&gt;</span></td>




    </tr>




    <tr>




      <td>Align (or zero-pad) a specified number of bytes relative to the current PC.
Argument value range = 1-16.<br>




      <br>




For example use ALIGN 4 to ensure that the new PC is located at a module
address that is aligned in 4 byte entities. Another example would be to use
ALIGN 2 to make sure that the next PC address is located at an even address.
ALIGN only aligns addresses on the current module compilation - not on the
entire scope of the linked modules. If you want to align all linked modules to
even adresses, use an ALIGN at the end of each module.</td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold; font-family: monospace;"><a name="defm" id="defm"></a>ASCII
&lt;string expression&gt;<br>




ASCIIZ</span> <span style="font-weight: bold; font-family: monospace;">&lt;string
expression&gt;</span><br>




      <span style="font-weight: bold; font-family: monospace;">DM</span> <span style="font-weight: bold; font-family: monospace;">&lt;string
expression&gt;</span><br>




      <span style="font-weight: bold; font-family: monospace;">DMZ</span>
      <span style="font-weight: bold; font-family: monospace;">&lt;string
expression&gt;</span><br>




      <span style="font-weight: bold; font-family: monospace;">DEFM</span>
      <span style="font-weight: bold; font-family: monospace;">&lt;string
expression&gt;</span><br>




      <span style="font-weight: bold; font-family: monospace;">DEFMZ</span>
      <span style="font-weight: bold; font-family: monospace;">&lt;string
expression&gt;</span></td>




    </tr>




    <tr>




      <td>All these directives is&nbsp;the same thing; to store a string at current
PC.&nbsp;<br>




      <br>




Strings are enclosed in double quotes. Strings may be concatenated with byte
constants using&nbsp;'.' or ','.<br>




This is useful if control characters (or even arithmetic expressions resulting
into an 8bit value) need to be a part of the string and cannot be typed from
the keyboard.<br>




      <br>




All directive names ending with a Z indicates that the end&nbsp;of the string
is automatically null-terminated (appended with a 0 byte).<br>




      <br>




Example:<br>







      <pre>ASCIIZ <span style="color: rgb(221, 0, 0);">"This is a title"</span>, 13, 10<br>
DEFM <span style="color: rgb(221, 0, 0);">"(c) Zsoft 1995-2006"</span>, 13, 10, 'A', 0<br>
DMZ 1 . <span style="color: rgb(221, 0, 0);">"7#1"</span> . 32 . 32 . 32<span style="color: rgb(0, 128, 0);">+</span>94 . 32<span style="color: rgb(0, 128, 0);">+</span>8 . 128<br></pre>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><a name="binary" id="binary"></a><span style="font-family: monospace; font-weight: bold;">BINARY
"&lt;filename&gt;"</span></td>




    </tr>




    <tr>




      <td>Loads a binary file at the assembler PC. This could for example be a static
data structure or an executable machine code routine. The loaded binary file
information is included into the object file code section. The assembler PC is
updated to the end of the loaded binary code.</td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-family: monospace; font-weight: bold;"><a name="byte" id="byte"></a>BYTE
&lt;8bit expr&gt;,{&lt;8bit expr&gt;}&nbsp;</span><br>




      <span style="font-weight: bold; font-family: monospace;">DB</span> <span style="font-family: monospace; font-weight: bold;">&lt;8bit expr&gt;,{&lt;8bit
expr&gt;}&nbsp;</span><br>




      <span style="font-weight: bold; font-family: monospace;">DEFB</span>
      <span style="font-family: monospace; font-weight: bold;">&lt;8bit
expr&gt;,{&lt;8bit expr&gt;} (-128; 255)</span></td>




    </tr>




    <tr>




      <td>Stores one or several bytes (8 bits) at the current assembler PC.
Expressions may be used to calculate the constant.<br>




      <br>




Example:<br>







      <pre>DEFB (topic_info_help <span style="color: rgb(0, 128, 0);">-</span> z80asm_help) / 256<span style="color: rgb(128, 128, 128);"><span style="font-family: mon;"><span style="font-style: italic;">, </span></span></span>(topic_info_help <span style="color: rgb(0, 128, 0);">-</span> z80asm_help) % 256, @00010010<br></pre>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold; font-family: monospace;"><a name="calloz" id="calloz"></a>CALL_OZ [(]&lt;numerical expr&gt;[)]<br>




OZ&nbsp;</span><span style="font-weight: bold; font-family: monospace;">[(]&lt;numerical
expr&gt;[)]</span></td>




    </tr>




    <tr>




      <td>The Z88 operating system call interface, which is a macro-like wrapper
around the RST 20H instruction followed by one or two byte manifest opcodes.
Use this call with the standard Z88 operating system definition files. This
pseudo directive will be implemented as a macro definition in a future version
of Mpm.<br>




      <br>




Example:<br>




      <br>




      <span style="font-family: monospace;">LD &nbsp; HL, msg</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">CALL_OZ GN_Sop</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">RET</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">.msg DMZ "Hello world!"</span><br style="font-family: monospace;">



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold; font-family: monospace;"><a name="call_pkg" id="call_pkg"></a>CALL_PKG</span> <span style="font-weight: bold; font-family: monospace;">[(]&lt;numerical
expr&gt;[)]</span></td>




    </tr>




    <tr>




      <td>Similar to <span style="font-family: monospace;">CALL_OZ</span>, this is a
Z88 calling interface (a RST 10H wrapper) to Garry Lancasters Package
management tool chain.<br>




This pseudo directive will be implemented as a macro definition in a future
version of Mpm.<br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr style="font-family: monospace; font-weight: bold;">




      <td style="background-color: rgb(239, 239, 239);"><a name="defc" id="defc"></a>DEFC name=&lt;numerical expr&gt;{, name=&lt;numerical expr&gt;}<br>




DC name=&lt;numerical expr&gt;{, name=&lt;numerical expr&gt;}</td>




    </tr>




    <tr>




      <td>Define a symbol constant, based on a numerical expression. The allowed
range is a signed 32bit integer value (-2147483647; 4294967295). The expression
must be evaluable, i.e. without forward referencing identifiers. Good practice
is to put constant definition in external files that you can <span style="font-family: monospace;">INCLUDE</span> into your source files.<br>




      <br>




Example:<br>




      <br>




      <span style="font-family: monospace;">DEFC ERR_file_open = $80,
ERR_syntax&nbsp;= $81</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">DC TotalWorkspace = END_VARS -
z80asm_vars</span><br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr style="font-family: monospace; font-weight: bold;">




      <td style="background-color: rgb(239, 239, 239);"><a name="defgroup" id="defgroup"></a>DEFGROUP | ENUM<br>




name {',' name ['=' &lt;numerical expr&gt;]}<br>




ENDDEF<br>



      </td>




    </tr>




    <tr>




      <td>Defines a group of identifier symbols with implicit values. This is similar
to the enumeration principles used in C and PASCAL. The initial symbol value is
0, increased by 1 for each new symbol in the list. You may include a &lt;name =
expression&gt; which breaks the linear enumeration from that constant.<br>




The <span style="font-family: monospace;">DEFGROUP</span> directive may be
spanned across several lines and MUST be enclosed with ended with en
      <span style="font-family: monospace;">ENDDEF</span> statement. <span style="font-family: monospace;"><br>




DEFGROUP</span> is just a more easy way than: <span style="font-family: monospace;">DEFC name0 = 0, name1 = name0,</span> ...<br>




      <br>




The following example illustrates a useful example of defining symbol
values:<br>




      <br>




      <span style="font-family: monospace;">DEFGROUP</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">sym_null, sym_dquote, sym_squote,
sym_semicolon, sym_comma, sym_fullstop, sym_lparen, sym_lcurly, sym_rcurly,
sym_rparen, sym_plus, sym_minus, sym_multiply, sym_divi, sym_mod, sym_power,
sym_assign, sym_strconq, sym_and, sym_or, sym_xor, sym_not, sym_less,
sym_greater, sym_constexpr, sym_newline</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">ENDDEF</span><br style="font-family: monospace;">



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr style="font-family: monospace; font-weight: bold;">




      <td style="background-color: rgb(239, 239, 239);"><a name="define" id="define"></a>DEFINE name {, name}<br>




DEFSYM name {, name}<br>




UNDEFINE name {, name}</td>




    </tr>




    <tr>




      <td>Defines a symbol identifier as logically true (integer = 1). The symbol
will be created as a variable only for the current module being compiled and
disappears when assembly is finished on the current source file module. Nice
feature for conditional assembly using the IF, ELSE, ENDIF directives. Equally,
you can remove a previously created local symbol .<br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr style="font-family: monospace;">




      <td style="background-color: rgb(239, 239, 239);"><a name="defl" id="defl"></a><span style="font-weight: bold;">DEFL &lt;32bit numerical expr&gt;
{,&lt;32bit numerical expr&gt;}</span><br style="font-weight: bold;">




      <span style="font-weight: bold;">LONG &lt;32bit numerical expr&gt; {,&lt;32bit
numerical expr&gt;}</span></td>




    </tr>




    <tr>




      <td>Stores one or several long integers (32 bits) at the current assembler PC
in low byte, high byte order (little endian). Integer range is (-2147483647;
4294967295). Expressions may be used to calculate the constant.<br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr style="font-family: monospace;">




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold;"><a name="defp" id="defp"></a>DEFP &lt;24bit pointer&gt;
{,24bit pointer} &nbsp;&nbsp; ( 24bit pointer = &lt;16bit numerical
expr&gt;,&lt;8bit numerical expr&gt;)</span><br style="font-weight: bold;">




      <span style="font-weight: bold;">DP&nbsp;</span><span style="font-weight: bold;">&lt;24bit pointer&gt; {,24bit pointer}</span></td>




    </tr>




    <tr>




      <td>Stores a 24bit pointer (16bit bank offset, then bank number)&nbsp;at the
current assembler PC in low byte, high byte order (little endian). This
directive is primarily used for Z88 memory data structures.<br>




      <br>




Example:<br>




      <br>




      <code><span style="font-family: monospace;">.InfoEnd0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DEFB
'H'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp;; Key to help section</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFB
12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp;; total length of help</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFP
z80asm_topics,</span><span style="font-family: monospace;">&nbsp;z80asm_MTH_bank &nbsp; &nbsp;; point to topics
(info)</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFP
z80asm_commands</span><span style="font-family: monospace;">,
z80asm_MTH_bank&nbsp;&nbsp;; point to commands (info)</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFP
z80asm_help,</span> <span style="font-family: monospace;">z80asm_MTH_bank&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;
point to help</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFP
token_base,</span> <span style="font-family: monospace;">tokens_bank&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
; point to token base</span></code></td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold; font-family: monospace;"><a name="defs" id="defs"></a>DEFS
&lt;size numerical expr&gt; [,(&lt;byte&gt;)]<br>




DS</span> <span style="font-weight: bold; font-family: monospace;">&lt;size
numerical expr&gt; [,(&lt;byte&gt;)]<br>




SPACE</span> <span style="font-weight: bold; font-family: monospace;">&lt;size
numerical expr&gt; [,(&lt;byte&gt;)]</span></td>




    </tr>




    <tr>




      <td>Allocates (fill) storage space at current PC. The size of the area will be
filled with zero bytes, or optionally with the &lt;byte&gt; specifier. Both
arguments may be defined as expressions.<br>




      <br>




Example:<br>




      <br>




      <span style="font-family: monospace;">DEFS 256 &nbsp; &nbsp; ; fill 256 zero
bytes in memory</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">DS 16,($FF) &nbsp;; fill 16 bytes with
$FF</span><br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-family: monospace; font-weight: bold;"><a name="defvars" id="defvars"></a>DEFVARS | DV | VARAREA &lt;numerical expression&gt;</span>
      <span style="font-family: monospace; font-weight: bold;">{ [&lt;name&gt;]
[&lt;storage_size&gt; &lt;size_multiplier&gt;] }</span><br style="font-family: monospace; font-weight: bold;">




      <span style="font-family: monospace; font-weight: bold;">ENDDEF</span><br style="font-family: monospace; font-weight: bold;">





      <br style="font-family: monospace; font-weight: bold;">




      <span style="font-family: monospace; font-weight: bold;">&lt;name&gt; ::= 'a'
.. 'z', '_', '0' .. '9'</span><br style="font-family: monospace; font-weight: bold;">




      <span style="font-family: monospace; font-weight: bold;">&lt;storage_size&gt;
::= 'ds.b' | 'ds.w' | 'ds.p' | 'ds.l'</span><br>



      </td>




    </tr>




    <tr>




      <td>Defines variable address area or offsets. First you define the origin of a
variable area. This may be defined using an evaluable&nbsp; expression
(positive). Each variable name is followed by a size specifier which can be a
byte, word, pointer (3 bytes) or long word size (4 byte). This is particularly
useful for defining dynamic data structures in linked lists and binary search
trees. Defining variable areas are a more dynamic way of
doing&nbsp;<span style="font-family: monospace;">DEFC</span> definitions in a
group of names that are joined together. a <span style="font-family: monospace;">DEFVARS</span> area is enclosed with an <span style="font-family: monospace;">ENDDEF</span> statement. An example:<br>




      <br>




      <span style="font-family: monospace;">DEFVARS asm_vars</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; RuntimeFlags1 ds.b 1 ; space for
next variable is 1 byte</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; RuntimeFlags2 ds.b
1</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; RuntimeFlags3 ds.b
1</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; explicitORIG &nbsp;ds.w 1 ; 2
bytes space</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; asmtime &nbsp; &nbsp; &nbsp; ds.b
3 ; 3 bytes space</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; datestamp_src ds.b 6 ; 6 bytes
space</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; datestamp_obj ds.b
6</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; TOTALERRORS &nbsp; ds.l 1 ; 4
bytes space</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">ENDDEF</span><br>




      <br>




the following is useful for defining dynamic data structures:<br>




      <br>




      <span style="font-family: monospace;">DV 0</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; ; 'PfixStack' structure (used for
postfix expressions):</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; pfixstack_const &nbsp; &nbsp; ds.l
1 ; The stack item value</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; pfixstack_previtem &nbsp;ds.p 1 ;
Pointer to previous element on stack</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; SIZEOF_pfixstack &nbsp;
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;; total size of data
structure</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">ENDDEF</span><br style="font-family: monospace;">




      <br>




This type of variable declaration makes it very easy for modifications, e.g.
deleting or inserting variable definitions.</td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold; font-family: monospace;"><a name="error" id="error"></a>ERROR "&lt;error message&gt;"</span></td>




    </tr>




    <tr>




      <td>Report a user defined error and&nbsp;exit compilation of source code. This
enables you to implement a built-in error handling during compilation of your
software, which extends the standard error conditions in Mpm (see at the bottom
of this document for the pre-defined error messages in Mpm). The error message
will be written to the current error message file associated with the source
file being compiled.<br>




      <br>




Example:<br>




      <br>




      <span style="font-family: monospace;">IF $PC &gt; 16384</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp; ERROR "Code size exceeds 16K bank
size."</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">ENDIF</span><br style="font-family: monospace;">



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold; font-family: monospace;"><a name="extcall" id="extcall"></a>EXTCALL &lt;16bit expr&gt;,&lt;8bit expr&gt;</span></td>




    </tr>




    <tr>




      <td>Pseudo directive for 24bit CALL addressing in OZ V4.2 (implements RST 10H
instruction, followed by 24bit address in low byte, high byte order). This new
system call automatically handles bank switching of the default segment that is
part of the specified address. This directive will be implemented as a macro
definition in a future version of Mpm.</td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold; font-family: monospace;"><a name="extern" id="extern"></a>EXTERN name {, name}<br>




XREF</span> <span style="font-weight: bold; font-family: monospace;">name {,
name}</span></td>




    </tr>




    <tr>




      <td>Declares symbol as external to the current source module. The name must
have been defined as <span style="font-family: monospace;">XDEF</span> (or
      <span style="font-family: monospace;">GLOBAL</span>) in another source module
to let this module reach the value of the symbol during the linking
phase.<br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold; font-family: monospace;"><a name="fpp" id="fpp"></a>FPP
['('] &lt;8bit expr&gt; [)]</span></td>




    </tr>




    <tr>




      <td>Pseudo directive which is used as the interface to the Z88 operating system
floating point library. This is easier than writing: <span style="font-family: monospace;">RST 18H</span> followed by a new line with
      <span style="font-family: monospace;">DEFB</span> directive<br>




      <br>




This is an advanced <span style="font-family: monospace;">RST 18H</span>&nbsp;
instruction which automatically allocates space for the specified parameter.
All Z88 floating point call mnemonics are defined in the "fpp.def" Z88
operating system definitions file. Here's an example:<br>




      <br>




      <span style="font-family: monospace;">CALL PopItem&nbsp;&nbsp; ; const =
PopItem(stackptr)</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">FPP&nbsp; (FP_NEG)&nbsp; ; const = -
const</span><br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-weight: bold; font-family: monospace;"><a name="global" id="global"></a>GLOBAL</span> <span style="font-weight: bold; font-family: monospace;">name {, name}</span><br>




      <span style="font-weight: bold; font-family: monospace;">XDEF name {,
name}</span></td>




    </tr>




    <tr>




      <td>Declares symbol globally available to other specified source file modules
during the linking phase of the compilation process.<br>




      <br>




All source modules may refer to each others symbols by using XREF directives.
This means that you refer to external information outside the current source
module. The opposite of an external module reference is to declare symbols
globally available using a XDEF directive, i.e. making symbols available to
other source modules.<br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr>




      <td style="background-color: rgb(239, 239, 239);"><span style="font-family: monospace; font-weight: bold;"><a name="if" id="if"></a>IF
&lt;logical expression&gt;</span><br style="font-family: monospace; font-weight: bold;">




      <span style="font-family: monospace; font-weight: bold;">[ELSE]</span><br style="font-family: monospace; font-weight: bold;">





      <span style="font-family: monospace; font-weight: bold;">ENDIF</span><br>



      </td>




    </tr>




    <tr>




      <td>Multi-line-directive. This allows to assemble particular source lines
between the <span style="font-family: monospace;">IF</span>, <span style="font-family: monospace;">ELSE</span> and <span style="font-family: monospace;">ENDIF</span> directives. The logical truth of the
      <span style="font-family: monospace;">IF</span> condition depends on which
source lines will be assembled inside the directive construction. <span style="font-family: monospace;">ELSE</span> is optional. Infinite nesting of
      <span style="font-family: monospace;">IF</span> directives are allowed.&nbsp;
Each directive must be specified on separate lines. An example:<br>




      <br>




      <span style="font-family: monospace;">if QDOS</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
INCLUDE "defs_h"</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
INCLUDE "stdio_def"</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">else</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
INCLUDE "defs.h"</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
MSDOS | UNIX</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
INCLUDE "stdio.def"</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
endif</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
Z88</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
INCLUDE ":*//stdio.def"</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
endif</span><br style="font-family: monospace;">




      <span style="font-family: monospace;">endif</span><br style="font-family: monospace;">




      <br>




You can specify compile time symbols with the <a href="#options_par"><span style="font-family: monospace;">-D</span> option</a> at
the Mpm command line to control which part of the source code is compiled.
Please refer to all the <a href="#relop">relational expression operators</a>
and <a href="#arithop">logical/arithmetical operators</a> to know how to
combine your <span style="font-family: monospace;">IF - ELSE - ENDIF</span>
logic.<br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<table style="text-align: left; background-color: rgb(255, 255, 255); width: 100%;" border="1" cellpadding="2" cellspacing="2">




  <tbody>




    <tr style="font-family: monospace; font-weight: bold;">




      <td style="background-color: rgb(239, 239, 239);"><a name="include" id="include"></a>INCLUDE "filename"</td>




    </tr>




    <tr>




      <td>A&nbsp;frequent usage pattern is to 'link' an additional source
file together with the current source file. Usually this contains variable
definitions that is commonly used by several modules in a project. This makes
sense since there is no idea in copying the same information into several files
- it simply uses redundant space of your storage media and makes it harder to maintain. The external source
file will be included at the position of the <span style="font-family: monospace;">INCLUDE</span> directive. You specify an include file
as with the following example:<br>




      <br style="font-family: monospace;">




      <span style="font-family: monospace;">include "stdio.def"</span><br>




      <br>




The format of the filename depends on the operating system platform. As with
the current source file, you may also insert files in include files. There is
no limit of how many levels (of files) you specify of include files. Recursive
or mutual recursive <span style="font-family: monospace;">INCLUDE</span> files
(an <span style="font-family: monospace;">INCLUDE</span> file calling it self) will be caught.<br>




      <br>




You can define an absolute path name inside the string argument, but it is not
recommended, especially if you want to make your sources platform independent.
Use the <a href="#include_searchpath">-I search path</a> Mpm command line
option to add all the directories that will be scanned for the specified
file(name), or predefine that search path using the <a href="#envvar"><span style="font-family: monospace;">MPM_Z80_INCLUDEPATH</span></a>
environment variable.<br>



      </td>




    </tr>







  </tbody>
</table>




<br>




<br>




<br>




.xlib name {,name}<br>




<br>




Declares symbol as external to the current module. The symbol name will be
defined as the name of a library routine which will be automatically linked
into the application code from a library during the linking/relocation phase of
the compilation process (if a library has been specified at the command line
with the -i option).<br>




<br>




<br>




.lstoff<br>




Switches listing output to file off temporarily. The listing file is not
closed.<br>




<br>




.lston<br>




Enables listing output (usually from a previous LSTOFF). Both directives may be
useful when information from INCLUDE files is redundant in the listing file,
e.g. operating system definitions.<br>




<br>




<br>




.module name<br>




<br>




Defines the name of the current module. This may be defined only once for a
module. All source file modules contain a module name. This name is used by the
assembler when creating address map files and for searching routines in
libraries. Further, it allows the programmer to choose a well defined name for
the source file module. The position of the module name is of no importance; it
may be placed at the end or the start of the source file. However, it has more
sense to put it at the top. The syntax is simple - specify a legal identifier
name after the MODULE directive, e.g. MODULE main_module<br>




<br>




<br>




.org &lt;32bit expression&gt;<br>




<br>




Define address origin of compiled machine code - the position in memory where
the machine is to be loaded and executed. The expression must be evaluable
(containing no forward or external references). All address references will be
calculated from the defined ORG value. The ORG address will be placed in the
current module that is being compiled. However, during linking only the first
object module is being read for an ORG address. The ORG is ignored during
linking if you have specified an -r option on the command line.<br>




<br>




<br>




.global name {, name}<br>




<br>




Declares symbol globally available to other specified source file modules
during the linking phase of the compilation process.<br>




<br>




<br>




.lib name<br>




<br>




When you need to create a library routine, it is necessary to declare the
routine with LIB. In functionality it declares the name globally available to
all other modules in project, but also serves as a search able item in
libraries. A library routine does not contain a MODULE directive, since the LIB
name is also identified as the module name (you only specify one library
routine per module).<br>




<br>




<br>




<br>




<br>




<br>




<big>Run time error messages</big><br>




<br>




The following error messages will be written in corresponding error files
(related to a source file). Each error message will contain the name of the
source file and a line number where the error occurred in the file.<br>




<br>




0, "File open/read error"<br>




You have tried to access a file that either was not found, already opened by
other resources, or the assembler wasn't able to create output files (object
file, listing-, symbol-, map- or executable binary file).<br>




<br>




1, "Syntax error"<br>




This is a message used by many routines - hence the general but descriptive
message. You have tried to use illegal registers in Z80 mnemonic instructions,
specified an illegal parameter type (string instead of integer), omitted a
parameter (DEFB without constant).<br>




<br>




2, "Symbol not defined"<br>




This error is given if you are referring to an identifier (usually in an
address reference) that was not declared. Either a label definition is missing
in the current module or you have forgotten to declare an identifier as
external using the XREF directive.<br>




<br>




3, "Not enough memory"<br>




Well, well. It seems that there wasn't enough room to hold the internal data
structures during parsing or linking your code.<br>




<br>




4, "Integer out of range"<br>




You have an expression which evaluates into a constant that are beyond the
legal integer range (e.g. trying to store a 16bit value into an 8bit
parameter).<br>




<br>




5, "Syntax error in expression"<br>




Quite clearly you have made an illegal expression, e.g. specifying two
following operands without an operator to separate them, used an illegal
constant specifier or using illegal characters that aren't a legal
identifier.<br>




<br>




6, "Right bracket missing"<br>




Your expression is using brackets and is not properly balanced, i.e. too many
beginning brackets or to few ending brackets...<br>




<br>




7, "Out of range"<br>




Same as 4.<br>




<br>




8, "Source filename missing"<br>




There has not been specified any source file modules or project file to start a
compilation.<br>




<br>




9, "Illegal option"<br>




The command line parser couldn't recognize the -option. Remember to specify
your option in EXACT case size. You have probably used a space between an
option and a filename parameter.<br>




<br>




10, "Unknown identifier"<br>




The parser expected a legal identifier, i.e. a directive or Z80 mnemonic. You
have probably omitted the '.' in front of a label definition, misspelled a name
or used a comment without a leading ';'.<br>




<br>




11, "Illegal identifier"<br>




You have been trying to use a name that is either not known to the parser or an
illegal identifier. This might happen if you try to use a register that is not
allowed in a LD instruction, e.g. LD A,F .<br>




<br>




12, "Max. code size reached"<br>




Is that really possible? Very interesting code of yours! Z80 machine code
program tend to be in the 2Mb range (at least on the Sony Play Station)...<br>




<br>




13, "errors occurred during assembly"<br>




Status error message displayed on the screen when the assembler has completed
its parsing on all modules. You have one or more errors to correct in your
source files before the assembler continues with linking the next time.<br>




<br>




14, "Symbol already defined"<br>




In the current source file, you have tried to create two identical address
label definitions, or other name identifier creators (using DEFC, DEFVARS,
DEFGROUP).<br>




<br>




15, "Module name already defined"<br>




You have used the MODULE directive more than once in your source file, or used
both a MODULE and XLIB directive (library modules only need an XLIB).<br>




<br>




16, "Module name not defined"<br>




A MODULE directive is missing in your source file (or XLIB directive in a
library source file routine).<br>




<br>




17, "Symbol already declared local"<br>




You have tried to declare a symbol as XREF, but it was already defined local,
eg. using a ".lbaddr" in your source.<br>




<br>




18, "Symbol already declared global"<br>




You have two identical XDEF symbol declarations in your source file module.<br>




<br>




19, "Symbol already declared external"<br>




You have two identical XREF symbol declarations in your source file module.<br>




<br>




20, "No command line arguments"<br>




Ups - display MPM Module Assembler help text.<br>




<br>




21, "Illegal source filename"<br>




You have tried to specify an option after having begun to specify filenames.
Options must always be specified before filenames or project files.<br>




<br>




22, "Symbol declared global in another module"<br>




You have two identical XDEF definitions in separate modules. One of them should
probably be an XREF instead.<br>




<br>




23, "Re-declaration not allowed"<br>




You are trying to specify an XDEF for a name that has already been XREF'ed in
the same module (or the other way around).<br>




<br>




24, "ORG already defined"<br>




Not used.<br>




<br>




25, "Relative jump address must be local"<br>




You have tried to JR to a label address that is declared as external (with XREF
or LIB). JR must be performed in the current source file module.<br>




<br>




26, "Not a relocatable file" / "Not an object file"<br>




The assembler opened a supposed object file (with the proper ".obj" extension)
but realized it wasn't conforming to the Z80 assembler standard object file
format.<br>




<br>




27, "Reserved name"<br>




You have tried to create a label or other name as "ASMPC".<br>




<br>




28, "Couldn't open library file"<br>




The library file was found but couldn't be opened (probably already opened by
another application resource)<br>




<br>




29, "Not a library file"<br>




Your library file is not a library file (at least is not of the correct file
format used by this assembler). Have you maybe used another "library" file? The
MPM library file could also be corrupted (at least in the header)...<br>




<br>




30, "Environment variable not defined"<br>




The assembler reports that either the "MPM_DEFFILES" or "MPM_STDLIB"
environment variables wasn't found in the operating system.<br>




<br>




31, "Cannot include file recursively"<br>




An file was tried to be included which was already included at a previous
include level. INCLUDE "a.h" cannot contain an INCLUDE "a.h"...
</body>
</html>
