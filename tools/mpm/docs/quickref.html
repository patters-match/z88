<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
  <title>Mpm Quick Reference Guide</title>


</head>


<body>

<div style="text-align: center;"><big>[M]ultiple
[P]rocessor [M]odule Assembler - Z80 Edition V1.2, 2006<br>

Quick Reference Guide (draft)</big><br>

</div>

<br>

<hr style="width: 100%; height: 2px;">Copyright (C)
1991-2006, Gunther Strube, gbs@users.sf.net <br>

<br>

This file is part of Mpm. Mpm is free software; you can redistribute it
and/or modify it
under the terms of the GNU General Public License as published by the
Free Software
Foundation; either version 2, or (at your option) any later version.
Mpm is distributed in
the hope that it will be useful, but WITHOUT ANY WARRANTY; without even
the implied warranty
of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
General Public License
for more details. You should have received a copy of the GNU General
Public License along
with Mpm; see the file COPYING. If not, write to the Free Software
Foundation, Inc., 59
Temple Place - Suite 330, Boston, MA 02111-1307, USA.<br>

<hr style="width: 100%; height: 2px;"><br>

<big>Instructing the assembler on the command line</big><br>

<br>

Mpm is executed using the operating system standard command line
environment (CLI).
<p>When executing the assembler from the command line without
options, i.e.
<span style="font-family: monospace;">mpm&lt;ENTER&gt;</span>,
a help page is automatically displayed where
after control is returned to
the operating system command line. The page shortly explains the syntax
of option
specification and which options are available.</p>

<p>The syntax of the assembler options is a straightforward
design. Filenames or a project
file are always specified. The options may be left out (surrounded here
with
[]):&nbsp;</p>

<span style="font-family: monospace;">mpm [<span style="font-weight: bold;">-</span>options]&nbsp;{filename(s)}
|&nbsp;@projectfile</span>
<p>As seen above&nbsp;<span style="font-family: monospace;">[-options]</span>
must be specified first,
followed by the names of
assembler source files. You either choose to specify all file names or
a <span style="font-family: monospace;">@&lt;projectfile&gt;</span>
containing all file names. Filenames may
be specified with or without
the .asm filename extension. At least on source file must be specified
and may be repeated
with several file names. Only one project file may be specified if no
source file names are
given. </p>

<p>Options are used to control the assembly process
and output. They are
recognized by the assembler when you specify a leading minus before the
option identifier
('-'). When the assembler is
executed options are all preset with default values and are either
switched ON or OFF (active
or not).&nbsp; </p>


<p>Upper and lower case letters are distinguished, which means
that 'a' is a different
command than 'A'. If an option is to be turned off, a 'n' is specified
before the
identification, e.g. <span style="font-family: monospace;">-nl</span>.
Default options are: <span style="font-weight: bold; font-family: monospace;">-sm
-nvadbctgA<br>
</span></p>

<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">

  <tbody>

    <tr align="center">

      <td colspan="2"><span style="font-style: italic;">Options
without parameters</span></td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-v</span></td>

      <td>Verbose output during assembly. Not enabled by default.</td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-t</span></td>

      <td>Create listing file output. Listing file contains
generated machine code output combined with source code lines and
optionally a symbol table. Not enabled by default.</td>

    </tr>

    <tr>

      <td style="vertical-align: top; font-family: monospace;">-s</td>

      <td>Create symbol table in listing file. Enabled by default.</td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-m</span></td>

      <td>Create address map information file (only when
performing linking of object files&nbsp;).&nbsp;Enabled by
default.</td>

    </tr>

    <tr>

      <td style="vertical-align: top; font-family: monospace;">-d</td>

      <td>Assemble
only updated source files.&nbsp;Not enabled by default (always
compile even if object file exists).</td>

    </tr>

    <tr>

      <td style="vertical-align: top; font-family: monospace;">-b</td>

      <td>Link object files into executable binary. Not enabled
by default.</td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-a</span></td>

      <td>Assemble
only updated source files and automatically link object files into
executable binary.&nbsp;Not enabled by default.</td>

    </tr>

    <tr>

      <td><span style="font-family: monospace;">-c</span></td>

      <td>Split linked executable&nbsp;into 16K binary files
(using .bnX extension). Not enabled by default.</td>

    </tr>

    <tr>

      <td style="vertical-align: top; font-family: monospace;">-g</td>

      <td>Create global address definition file. Not enabled by
default.</td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-A</span></td>

      <td>Address align DEFW &amp; DEFL constants. Not
enabled by default.</td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-C</span></td>

      <td>Override compile error/warnings line numbers using
external source code line number reference (specify external line
numbers with LINE directive in souce code). Implemented as "C line
mode" when Mpm functions as back end for z88dk C compiler. Not enabled
by default.</td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-R</span></td>

      <td>Generate relocatable executable binary (code needs to
run in RAM). Not enabled by default.</td>

    </tr>
    <tr>
      <td style="vertical-align: top;"><span style="font-family: monospace;">-plus</span></td>
      <td>INVOKE directive generates&nbsp;RST 28H instruction opcode (otherwise CALL instruction). Not enabled by default.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span style="font-family: monospace;">-IXIY</span></td>
      <td>All IY related instructions are generated with IX instruction opcodes and vice versa. Not enabled by default.</td>
    </tr>

  </tbody>
</table>

<br>
<br>

<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">

  <tbody>

    <tr align="center">

      <td colspan="2"><span style="font-style: italic;">Options
with parameters</span></td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-D&lt;symbol name&gt;</span></td>

      <td>Define symbol name as logically TRUE and available for current compilation session.<br>
      </td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-r&lt;address&gt;</span></td>

      <td>Re-define the ORG linking executable start address (override ORG directive in source code).</td>

    </tr>

    <tr>

      <td style="vertical-align: top; font-family: monospace;">-e&lt;ext&gt;</td>

      <td>Replace default "asm" source file name extension with&nbsp;&lt;ext&gt;. Max 3 letters (specified without ".")</td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-M&lt;ext&gt;</span></td>

      <td>Replace default "obj" filename extension for object module files with &lt;ext&gt;. Max 3 letters (specified without ".")</td>

    </tr>

    <tr>
      <td style="vertical-align: top;"><span style="font-family: monospace;">-o&lt;filename&gt;</span></td>
      <td>Override generated executable binary&nbsp;default filename with &lt;filename&gt;. Requires -b or -a option.<br>
      </td>
    </tr>

    <tr>

      <td style="vertical-align: top; font-family: monospace;">-b</td>

      <td><br>
      </td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-a</span></td>

      <td><br>
      </td>

    </tr>

    <tr>

      <td><span style="font-family: monospace;">-c</span></td>

      <td><br>
      </td>

    </tr>

    <tr>

      <td style="vertical-align: top; font-family: monospace;">-g</td>

      <td><br>
      </td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-A</span></td>

      <td><br>
      </td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-C</span></td>

      <td>.</td>

    </tr>

    <tr>

      <td style="vertical-align: top;"><span style="font-family: monospace;">-R</span></td>

      <td><br>
      </td>

    </tr>

  </tbody>
</table>

<br>

<br>
<br>

- Include library modules during linking/relocation, -i<br>

This option allows compilation time linking of external machine code,
better known as library routines. Much, much programming time can be
saved by producing a set of standard routines compiled into library
files. These may then be included later in application project
compilations. The command line option allows specification of several
library files. For each library reference in an application module, all
library files will be scanned for that particular module. The filename
(inclusive directory path) of the library may be specified explicitly
on the command line immediately after the -i identifier. If you omit
the filename, a default library filename will be used by the assembler.
This default filename is defined by creating the environment variable
"MPM_STDLIB=..." ("..." refers to your filename). Please refer to your
operating system documentation on how to create environment variables.
Library files are recognized by the ".LIB" extension.<br>

<br>

- Create a library, -x<br>

A library file is composed of object files surrounded by a few file
structures. The library file format (and object file format) may be
found at the end of this documentation. A library is simply a set of
independent routines (that may refer to each other) put together in a
sequential form. You may only specify a single -x option on the command
line. A filename may be explicitly defined (including device and path
information) to determine the storage location of the library. As in -i
you may omit the filename to use the default filename identified by the
"MPM_STDLIB" environment variable. A library routine must be defined
using a simple XLIB directive with an identical address name label
definition. Please refer to further information later in this
documentation.<br>

<br>

One very important aspect of libraries is the time that the assembler
spends searching through them. To optimize the search you should place
your routines in a "topological" order, i.e. routines that access other
library routines should be placed first. In most situations you avoid
redundant sequential searching through the library.<br>

<br>

<br>
<big>Environment variables</big><br>

<br>

The following text describes how to execute the assembler and defining
the environment variables used by the assembler.<br>

<br>

o The environment variables<br>

The assembler uses two environment variables:<br>

<br>

"MPM_Z80_INCLUDEPATH"&nbsp;defines the default path of header/include definition
files.<br>

"MPM_Z80_STDLIBRARY" defines the default filename of the standard library
filename.<br>
"MPM_Z80_LIBPATH" defines the default seach path for Mpm library files.<br>
<br>
<br>
<big>MPM module assembler file types</big><br>

<br>

o The assembler file types and their extension names<br>

The MPM Module Assembler uses several different file name extensions to
distinguish the type of files processed. The base name of the source
file is used to create the various assembler output file types. The
following list explains the available files:<br>

<br>

o The file name extension identifier<br>

The file name extension identifier may be different from platform to
platform. UNIX has no defined standard. MSDOS and TOS uses '.'. QDOS
uses the '_' identifier. SMSQ also allows the '.' extension identifier.<br>

<br>

The Assembler implemented on the supplied platforms are defined with
the correct extension identifier. You can see this on the Assembler
help page (executing the program with no parameters).<br>

<br>

- The source file extension<br>

The extension for assembler mnemonic source files are 'asm'. Source
files are specified by the user with or without the extension -
whatever chosen, the assembler will investigate automatically what is
needed to read the source files.<br>

<br>

- The object file extension<br>

The extension for object files are 'obj'. The base file name is taken
from the corresponding source file name. This file is generated by the
assembler from parsing the source file and contains intermediate
generated machine code, an address origin of the machine code, symbol
information and expressions.<br>

<br>

- The error file extension<br>

The extension for error files are 'err'. Before beginning processing
the source files, an error file is created. If any errors should occur,
they will be written to this file containing information of where the
error occurred. If no error were found, the error file is automatically
closed and deleted. Error files are simple text files that can be
loaded by any text editor for evaluation.<br>

<br>

- The listing file extension<br>

The extension for listing files are 'lst'. The base file name is taken
from the corresponding source file name. This file is generated by the
assembler and contains a hexadecimal output of the generated machine
code that corresponds to the Z80 mnemonic instruction or directive,
followed by a copy of the original source line. If selected, the symbol
table is dumped at the end of the listing file.<br>

<br>

- The symbol file extension<br>

The extension for symbol table files are 'sym'. The base file name is
taken from the corresponding source file name. The symbol table file
contains information about the defined and used symbols of the source
file and their generated values (labels and constants). The symbol file
is only created if listing file output is disabled.<br>

<br>

- The executable file extension<br>

The extension for executable Z80 machine code files are 'bin'. The base
file name is taken from the first specified source file name at the
command line (or project file). This is the linked and relocated output
of object files and may be executed by the Z80 processor. You may
override this default behavior by using the -o option and specify your
own output filename (and extension).<br>

<br>

- The address map file extension<br>

The extension for address map files are 'map'. The base file name is
taken from the first specified source file name at the command line (or
project file). This file is generated by the assembler and contains a
list of all defined address labels from all linked/relocated modules
with their calculated (absolute) address in memory. Used for debugging
reference.<br>

<br>

- The definition file extension<br>

The extension for global address label definition files are 'def'. The
base file name is taken from the first specified source file name at
the command line (or project file). This file is generated by the
assembler and contains a list of all globally declared address labels
with their calculated (absolute) origin address, fetched only during
assembly of source file modules. The format of the list contains
constant definitions (addresses) and may be parsed e.g. as include
files for other projects.<br>

<br>

- The library file extension<br>

Library files are identified with the 'lib' extension. Library files
may be created using the -x option. Library may be included into
application code during linking of object modules. <br>

<br>

<br>

<big>The standard platform identifier<br>
<br>
</big>
When the MPM Assembler is running a standard platform identifier is
made available. The identifier reflects the name of the platform:<br>

<br>
"MSDOS" - the assembler is running on the MS-DOS or Windows&nbsp;platform of
computers<br>

"UNIX" - the assembler is running on the LINUX/UNIX/MAC OSX platform.<br>

<br>

The identifier might be very handy when you need to port your source
files to different computer platforms. We use them in for loading
header files. Have a look on the INCLUDE directive example in the
Directive Reference section. <br>

<br>
<br>

<big>Source file structure</big><br>
<br>
The composition of a source file module is completely free to the
programmer. How he chooses to place the source code on a text line has
no effect of the parsing process of the assembler. The linefeed
interpretation is also handled by MPM - it understands the following
formats:<br>

<br>

&lt;LF&gt; (used by QDOS/SMSQ/UNIX/AMIGA/MAC OSX),
&lt;CR&gt;&lt;LF&gt; (used by MSDOS),<br>

&lt;CR&gt; (used by Mac OS Release 8/9).<br>

<br>

<br>
<big>Comments in source files</big><br>
<br>
Comments in Z80 source files are possible using a semicolon. When the
assembler meets a semicolon the rest of the current source line is
ignored until the linefeed. Parsing will then commence from the
beginning of the line. The semicolon may be placed anywhere in a source
line. As stated you cannot place mnemonics after the semicolon - they
will be ignored. The Z80 parser will in many places accept comments
without a semicolon has been set - but don't rely on it. Better use a
semicolon. The context is much more clear. The following is an example
on how to use comments in Z80 source files:<br>

<br>

; **********************<br>

; main menu<br>

;<br>
mainmenu: xor a<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ret<br>
<br>
<br>

<big>Defining symbolic address labels<br>
<br>
</big>
The main reason for using an assembler is to be able to determine
symbolical addresses and use them as reference in the code. These are
defined by a name preceded with a full stop. It is allowed to place a
mnemonic or directive after an address label. An address label may be
left as a single statement on a line - you may of course use comment
after the label. The following is a label definition:<br>

<br>
mainmenu:<br>
.mainmenu2<br>

<br>

It is not allowed to position two labels on the same line. However, you
may place as many label after each other - even though no code is
between them. They just receive the same assembler address. It is not
allowed to specify two identical address labels in the same source file.<br>

<br>
<br>
<big>Using expressions</big><br>

<br>

Expressions is almost unavoidable in source files. They define and
explain things much clearer than just using a constant. The MPM Module
Assembler allows expressions wherever a parameter is needed. This
applies to Z80 mnemonic instructions, directives and even in character
strings. The resulting value from an evaluated expression is always an
integer. All expressions are calculated internal as 32 bit signed
integers. However, the parameter type defines the true range of the
expression. E.g. you cannot store a 32 bit signed integer at an 8 bit
LD instruction like LD A, &lt;n&gt; . If a parameter is outside
an
allowed integer range an assemble error is reported.<br>

<br>

Expressions may be formed as arithmetic and relational expressions.
Several components are supported: symbol names (identifiers),
constants, ASCII characters and various arithmetic operators.<br>

<br>

<big><br>
Constant identifiers<br>
<br>
</big>
Apart from specifying decimal integer numbers, you are allowed to use
hexadecimal constants, binary constants and ASCII characters. The
following symbols are put in front of the constant to identify the type:<br>

<br>

0x hexadecimal constant, e.g. 0x4000 (16384).<br>

@ binary constant, e.g. @11000000 (192).<br>

' ' ASCII character, e.g. 'a'.<br>

<br>

<br>

<big>Arithmetic operators</big><br>

All basic arithmetic operators are supported:<br>

addition, subtraction, power, multiplication, division and modulus.<br>

Binary logical operators are implemented: AND, OR, NOR, XOR and NOT (1.
complement).<br>

Finally, bit shift operators are available too: &lt;&lt; and
&gt;&gt; (sign NOT extended).<br>

<br>

+ addition, e.g. 12+13<br>

- unary minus, subtraction. E.g. -10, 12-45.<br>

* multiplication, e.g. 45*2 (90).<br>

/ division, e.g. 256/8 (32).<br>
%&nbsp;modulus, e.g. 256%PC%8 (0).<br>

** power, e.g. 2**7 (128).<br>

&amp; Binary AND, e.g. 255 &amp; 7 (7).<br>

| Binary OR, e.g. 128 | 64 (192).<br>

: Binary NOR, e.g. 128 : 128 (0).<br>

^ Binary XOR, e.g. 128 ^ 128 (0).<br>

~ Binary NOT, e.g. ~128 (127)<br>

&lt;&lt; Binary left shift, e.g. 2 &lt;&lt; 4 (32).<br>

&gt;&gt; Binary right shift, e.g. 128 &gt;&gt; 4 (8).<br>

<br>

# Truncate expression as constant (remove relocatable address flag)<br>

<br>

Arithmetic operators use the standard operator precedence, shown from
highest to lowest: <br>

<br>

0x @' (constant identifiers)<br>

()<br>

~<br>

**<br>

*/%<br>

+-|^&amp;:&lt;&lt; &gt;&gt;<br>

<br>

If you want to override the default operator precedence rules, use
brackets ().<br>

<br>

<br>

<big>The # operator</big><br>

This is not a real operator, though. It is only used as the first
symbol in an expression to identify that this expression evaluates to a
constant, i.e. containing no relocatable information. This feature may
be necessary when you have to calculate a distance between two address
labels without letting the assembler think it is a relocatable address.
The assembler thinks that expressions containing address labels are
relocatable items. In 99% of any expression used this is perfectly
adequate.<br>

<br>

During the linking phase such an expression may have unwanted side
effects. The relocator identifies the expression as an relocatable item
and will add a constant to the evaluated value of the expression. This
is a perfectly correct handling in normal address references for
relocatable code. However, since the assembler cannot see this as a
constant expression, you have to force it as one.<br>

<br>

****!!!!<br>

LD BC, end_relocator-relocator ; the relocator will add an ORG constant<br>

LD BC, #end_relocator-relocator ; the relocator sees a constant
expression<br>

****!!!!<br>

<br>

Normal executable code, compiled for a an absolute address, won't
conflict with the above problem, since no constants are added to
expressions. All address information is calculated during loading of
the address labels in pass 1 of the linking process. Pass 2 of the
linking process just evaluates expressions (thereby using the proper
values of labels and other constants) and patches them into the
corresponding locations of the code.<br>

<br>

<br>

<big>Relational operators</big><br>

With relational operators you may form logical expressions resulting in
true or false conditions. The resulting value of a true expression is
1. The resulting value of a false expression is 0. These operators are
quite handy when you need to perform complex logic for conditional
assembly in IF-ELSE-ENDIF statements. The following relational
operators are available:<br>

<br>

= equal to<br>

&lt;&gt; not equal to<br>

&lt; less than<br>

&gt; larger than<br>

&lt;= less than or equal to<br>

&gt;= larger than or equal to<br>

! not<br>

<br>

You may link several relational expressions with the binary operators
AND, OR, XOR and NOT. You have all the possibilities available!<br>

<br>

It is perfectly legal to use relational expressions in parameters
requiring an arithmetic value. For example: <br>

<br>

****!!!!<br>

LD A, (USING_IBM = 1) | RTMFLAGS<br>

<br>

<br>

<big>The assembler program counter standard function</big><br>

In occasional circumstances it may be necessary to use the current
location of the assembler program counter in an expression e.g.
calculating a relative distance. This may be done with the help of the
$PC identifier. An example: <br>

<br>

errmsg0: .ascii errmsg1 - $PC - 1 &amp; "File open error"<br>

errmsg1: .ascii errmsg2 - $pc - 1 &amp; "Syntax error"<br>

errmsg2:<br>

<br>

Here, a length byte of the following string (excluding the length byte)
is calculated by using the current $PC address value. <br>

<br>

<br>
<big>The . operator</big><br>

You may use expressions in string definitions when using the DEFM
directive. String constants are enclosed in double quotes, e.g.
"abcdefgh". Several strings and byte expressions may be concatenated
using the &amp; operator. The resulting type of an expression in
strings are an unsigned byte of the range of 0 to 255, e.g.:<br>

"string_a" . "string_b" . 'X' . CR . LF . 0<br>

<br>

<br>

<big>Symbol identifiers in expressions</big><br>

Apart from using integer constants in your expressions, names are
allowed as well. This is frequently used for symbolical address label
references (both external and local).<br>

<br>

Forward referencing of symbols is not really something that is
important in evaluating expressions. The logic is built into the
assembler parser. If an expression cannot be resolved in pass 1 of
source file parsing, it will try to re-evaluate the failed expression
in pass 2 of the parsing. If it still fails a symbol has not been found
unless it has been declared as an external or library symbol (which are
handled during the linking phase).<br>

<br>

<br>
<big>Directive reference</big><br>

<br>

The MPM Module Assembler directives are used to manipulate the Z80
assembler mnemonics and to generate data structures, variables and
constants. You are even permitted to include binary files while code
generation is performed.<br>

<br>

As the name imply they direct the assembler to perform other tasks than
just parsing and compiling Z80 instruction mnemonics. All directives
are treated as mnemonics by the assembler, i.e. it is necessary that
they appear as the first command identifier on the source line (NOT
necessarily the first character). Only one directive is allowed at a
single source line. Even though they are written as CAPITALS in this
documentation they may be written in mixed case letters in your source
files.<br>

<br>

Since the directives cover very different topics of assembler
processing, each directive will be explained in detail, identified with
a header description for each text section. The following syntax is
used:<br>

<br>

&lt;&gt; defines an entity, i.e. a number, character or string.<br>

{} defines a an optional repetition of an entity.<br>

[] defines an option that may be left out.<br>

<br>

<br>

.binary "filename"<br>

<br>

Loads a binary file at the assembler PC. This could for example be a
static data structure or an executable machine code routine. The loaded
binary file information is included into the object file code section.
The assembler PC is updated to the end of the loaded binary code.<br>

<br>

<br>

.byte &lt;8bit expr&gt;,{&lt;8bit expr&gt;} (-128; 255)<br>

.half &lt;16bit expr&gt;,{&lt;16bit expr&gt;} (-32768;
65535)<br>

.word &lt;32bit expr&gt;,{&lt;32bit expr&gt;}
(-2147483647; 4294967295)<br>

.long &lt;64bit expr&gt;,{&lt;64bit expr&gt;}
(-9223372036854775808; 9223372036854775807)<br>

<br>

Stores a byte (8 bit), half word (16 bit), word (32 bit) or long word
(64 bit) at the current assembler PC. Expressions may be used to
calculate the constant.<br>

<br>

****!!!!<br>

All constant are stored in low byte - high byte order (little endian).<br>

<br>

<br>

.defc name=&lt;32bit expression&gt;{, name=&lt;32bit
expression&gt;}<br>

<br>

Define a symbol constant. The allowed range is a signed 64bit integer
value. The expression must be evaluable, i.e. no forward referencing
identifiers.<br>

<br>

<br>

.ascii &lt;string expression&gt;<br>

.asciiz &lt;string expression&gt;<br>

<br>

Stores a string constant at the current assembler PC. Strings are
enclosed in double quotes. Strings may be concatenated with byte
constants using the '.' operator. This is useful if control characters
need to be a part of the string and cannot be typed from the keyboard.<br>

<br>

Using ".asciiz" will automatically append a zero (null-terminator)
after the string expression.<br>

<br>

<br>

.defgroup<br>

'{'<br>

name {',' name ['=' &lt;8bit expression&gt;]}<br>

'}'<br>

<br>

Defines a group of identifier symbols with implicit values. This is
similar to the enumeration principles used in C and PASCAL. The initial
symbol value is 0, increased by 1 for each new symbol in the list. You
may include a &lt;name = expression&gt; which breaks the linear
enumeration from that constant. The DEFGROUP directive may be spanned
across several lines and MUST be enclosed with { and }. DEFGROUP is
just a more easy way than: DEFC name0 = 0, name1 = name0, ...<br>

<br>

The following example illustrates a useful example of defining symbol
values:<br>

<br>

.defgroup<br>

{<br>

sym_null, sym_dquote, sym_squote, sym_semicolon, sym_comma,
sym_fullstop,<br>

sym_lparen, sym_lcurly, sym_rcurly, sym_rparen, sym_plus, sym_minus,<br>

sym_multiply, sym_divi, sym_mod, sym_power, sym_assign, sym_strconq,
sym_and,<br>

sym_or, sym_xor, sym_not sym_less, sym_greater, sym_constexpr,
sym_newline,<br>

sym_lf,<br>

<br>

sym_name, sym_number, sym_decmconst, sym_hexconst, sym_binconst,
sym_charconst,<br>

sym_lessequal, sym_greatequal, sym_notequal sym_negated, sym_nil,
sym_ifstatm,<br>

sym_elsestatm, sym_endifstatm<br>

}<br>

<br>

<br>

.define name,{name}<br>

<br>

Defines a symbol identifier as logically true (integer &lt;&gt;
0). The
symbol will be created as a local variable and disappears when assembly
is finished on the current source file module. Nice feature for
conditional assembly.<br>

<br>

<br>

.space &lt;16bit expression&gt;<br>

<br>

Allocates storage. The size of the area will be filled with zero bytes.
The expression must be [1; 65535].<br>

<br>

****!!!!<br>

.defvars &lt;16bit expression&gt;<br>

'{'<br>

[&lt;name&gt;] [&lt;storage_size&gt;
&lt;size_multiplier&gt;]<br>

{ [&lt;name&gt;] [&lt;storage_size&gt;
&lt;size_multiplier&gt;] }<br>

<br>

'}'<br>

<br>

&lt;name&gt; ::= 'a' .. 'z'<br>

&lt;storage_size&gt; ::= 'ds.b' | 'ds.w' | 'ds.p' | 'ds.l'<br>

<br>

Defines variable address area or offsets. First you define the origin
of a variable area. This may be defined using an evaluable 16bit
expression (positive). Each variable name is followed by a size
specifier which can be a byte, word, pointer (3 bytes) or long word
size. This is particularly useful for defining dynamic data structures
in linked lists and binary search trees. Defining variable areas are
only template definitions not allocations. An example:<br>

<br>

.defvars asm_vars<br>

{<br>

RuntimeFlags1 ds.b 1 ; space for next variable is 1 byte<br>

RuntimeFlags2 ds.b 1<br>

RuntimeFlags3 ds.b 1<br>

ds.w 1 ; space not defined<br>

explicitORIG ds.w 1 ; 2 bytes space<br>

asmtime ds.b 3 ; 3 bytes space<br>

datestamp_src ds.b 6 ; 6 bytes space<br>

datestamp_obj ds.b 6<br>

TOTALERRORS ds.l 1 ; 4 bytes space<br>

}<br>

<br>

the following is useful for defining dynamic data structures:<br>

<br>

.defvars 0<br>

; 'PfixStack' structure (used for postfix expressions):<br>

{<br>

pfixstack_const ds.l 1 ; The stack item value<br>

pfixstack_previtem ds.p 1 ; Pointer to previous element on stack<br>

SIZEOF_pfixstack ; total size of data structure<br>

}<br>

<br>

This type of variable declaration makes it very easy for modifications,
e.g. deleting or inserting variable definitions.<br>

<br>

<br>

<br>

IF &lt;logical expression&gt;<br>

[ELSE]<br>

ENDIF<br>

<br>

Multi-line-directive. This allows to assemble particular source lines
between the IF, ELSE and ENDIF directives. The logical truth of the IF
condition depends on which source lines will be assembled inside the
directive construction. ELSE is optional. Infinite nesting of IF
directives are allowed. Each directive must be specified on separate
lines. An example:<br>

<br>

if QDOS<br>

include "defs_h"<br>

include "symbol_def"<br>

include "stdio_def"<br>

include "fileio_def"<br>

include "memory_def"<br>

else<br>

include "defs.h"<br>

include "symbol.def"<br>

if MSDOS | UNIX<br>

include "stdio.def"<br>

include "fileio.def"<br>

include "memory.def"<br>

endif<br>

endif<br>

<br>

<br>

<br>

.include "filename"<br>

<br>

Another component that is frequently used is to 'link' an additional
source file together with the current source file. Usually this
contains variable definitions that is commonly used by several modules
in a project. This makes sense since there is no idea in copying the
same information into several files - it simply uses redundant space of
your storage media. The external source file will be included at the
position of the INCLUDE directive. You specify an include file as with
the following example:<br>

<br>

include "stdio.def"<br>

<br>

The format of the filename depends on the operating system platform. As
with the current source file, you may also insert files in include
files. There is no limit of how many levels (of files) you specify of
include files. Recursive or mutual recursive INCLUDE files (an INCLUDE
file calling it self) is not possible - the assembler program will
immediately return an error message back to you!<br>

<br>

Include files are usually put at the start of the source file module
but may be placed anywhere in the source text. The current source file
will be continued after the INCLUDE directive when the included file
has been parsed to the end of file.<br>

<br>

If you specify a leading '#' in the filename (as shown above) the
assembler automatically precedes a default directory path, defined from
the MPM_DEFFILES environment variable. Most of the time INCLUDE is used
for including operating system manifests - which enables you to place
them in a particular place on your system. Using the '#' also enables
you to have these definition files placed anywhere on any computer
platform. The '#' resolves this for you.<br>

<br>

<br>

.xlib name {,name}<br>

<br>

Declares symbol as external to the current module. The symbol name will
be defined as the name of a library routine which will be automatically
linked into the application code from a library during the
linking/relocation phase of the compilation process (if a library has
been specified at the command line with the -i option).<br>

<br>

<br>

.lstoff<br>

Switches listing output to file off temporarily. The listing file is
not closed. <br>

<br>

.lston<br>

Enables listing output (usually from a previous LSTOFF). Both
directives may be useful when information from INCLUDE files is
redundant in the listing file, e.g. operating system definitions.<br>

<br>

<br>

.module name<br>

<br>

Defines the name of the current module. This may be defined only once
for a module. All source file modules contain a module name. This name
is used by the assembler when creating address map files and for
searching routines in libraries. Further, it allows the programmer to
choose a well defined name for the source file module. The position of
the module name is of no importance; it may be placed at the end or the
start of the source file. However, it has more sense to put it at the
top. The syntax is simple - specify a legal identifier name after the
MODULE directive, e.g. MODULE main_module<br>

<br>

<br>

.org &lt;32bit expression&gt;<br>

<br>

Define address origin of compiled machine code - the position in memory
where the machine is to be loaded and executed. The expression must be
evaluable (containing no forward or external references). All address
references will be calculated from the defined ORG value. The ORG
address will be placed in the current module that is being compiled.
However, during linking only the first object module is being read for
an ORG address. The ORG is ignored during linking if you have specified
an -r option on the command line.<br>

<br>

<br>

.global name {, name}<br>

<br>

Declares symbol globally available to other specified source file
modules during the linking phase of the compilation process.<br>

<br>

<br>

.lib name<br>

<br>

When you need to create a library routine, it is necessary to declare
the routine with LIB. In functionality it declares the name globally
available to all other modules in project, but also serves as a search
able item in libraries. A library routine does not contain a MODULE
directive, since the LIB name is also identified as the module name
(you only specify one library routine per module).<br>

<br>

<br>

.extern name {, name}<br>

<br>

Declares symbol as external to the current module. The name must have
been defined as XDEF in another module to let this module reach the
value of the symbol during the linking phase.<br>

<br>

<br>

<br>
<big>Run time error messages</big><br>

<br>

The following error messages will be written in corresponding error
files (related to a source file). Each error message will contain the
name of the source file and a line number where the error occurred in
the file.<br>

<br>

0, "File open/read error"<br>

You have tried to access a file that either was not found, already
opened by other resources, or the assembler wasn't able to create
output files (object file, listing-, symbol-, map- or executable binary
file).<br>

<br>

1, "Syntax error"<br>

This is a message used by many routines - hence the general but
descriptive message. You have tried to use illegal registers in Z80
mnemonic instructions, specified an illegal parameter type (string
instead of integer), omitted a parameter (DEFB without constant).<br>

<br>

2, "Symbol not defined"<br>

This error is given if you are referring to an identifier (usually in
an address reference) that was not declared. Either a label definition
is missing in the current module or you have forgotten to declare an
identifier as external using the XREF directive.<br>

<br>

3, "Not enough memory"<br>

Well, well. It seems that there wasn't enough room to hold the internal
data structures during parsing or linking your code.<br>

<br>

4, "Integer out of range"<br>

You have an expression which evaluates into a constant that are beyond
the legal integer range (e.g. trying to store a 16bit value into an
8bit parameter).<br>

<br>

5, "Syntax error in expression"<br>

Quite clearly you have made an illegal expression, e.g. specifying two
following operands without an operator to separate them, used an
illegal constant specifier or using illegal characters that aren't a
legal identifier.<br>

<br>

6, "Right bracket missing"<br>

Your expression is using brackets and is not properly balanced, i.e.
too many beginning brackets or to few ending brackets...<br>

<br>

7, "Out of range"<br>

Same as 4.<br>

<br>

8, "Source filename missing"<br>

There has not been specified any source file modules or project file to
start a compilation.<br>

<br>

9, "Illegal option"<br>

The command line parser couldn't recognize the -option. Remember to
specify your option in EXACT case size. You have probably used a space
between an option and a filename parameter.<br>

<br>

10, "Unknown identifier"<br>

The parser expected a legal identifier, i.e. a directive or Z80
mnemonic. You have probably omitted the '.' in front of a label
definition, misspelled a name or used a comment without a leading ';'.<br>

<br>

11, "Illegal identifier"<br>

You have been trying to use a name that is either not known to the
parser or an illegal identifier. This might happen if you try to use a
register that is not allowed in a LD instruction, e.g. LD A,F .<br>

<br>

12, "Max. code size reached"<br>

Is that really possible? Very interesting code of yours! Z80 machine
code program tend to be in the 2Mb range (at least on the Sony Play
Station)...<br>

<br>

13, "errors occurred during assembly"<br>

Status error message displayed on the screen when the assembler has
completed its parsing on all modules. You have one or more errors to
correct in your source files before the assembler continues with
linking the next time.<br>

<br>

14, "Symbol already defined"<br>

In the current source file, you have tried to create two identical
address label definitions, or other name identifier creators (using
DEFC, DEFVARS, DEFGROUP).<br>

<br>

15, "Module name already defined"<br>

You have used the MODULE directive more than once in your source file,
or used both a MODULE and XLIB directive (library modules only need an
XLIB).<br>

<br>

16, "Module name not defined"<br>

A MODULE directive is missing in your source file (or XLIB directive in
a library source file routine).<br>

<br>

17, "Symbol already declared local"<br>

You have tried to declare a symbol as XREF, but it was already defined
local, eg. using a ".lbaddr" in your source.<br>

<br>

18, "Symbol already declared global"<br>

You have two identical XDEF symbol declarations in your source file
module.<br>

<br>

19, "Symbol already declared external"<br>

You have two identical XREF symbol declarations in your source file
module.<br>

<br>

20, "No command line arguments"<br>

Ups - display MPM Module Assembler help text.<br>

<br>

21, "Illegal source filename"<br>

You have tried to specify an option after having begun to specify
filenames. Options must always be specified before filenames or project
files.<br>

<br>

22, "Symbol declared global in another module"<br>

You have two identical XDEF definitions in separate modules. One of
them should probably be an XREF instead.<br>

<br>

23, "Re-declaration not allowed"<br>

You are trying to specify an XDEF for a name that has already been
XREF'ed in the same module (or the other way around).<br>

<br>

24, "ORG already defined"<br>

Not used.<br>

<br>

25, "Relative jump address must be local"<br>

You have tried to JR to a label address that is declared as external
(with XREF or LIB). JR must be performed in the current source file
module.<br>

<br>

26, "Not a relocatable file" / "Not an object file"<br>

The assembler opened a supposed object file (with the proper ".obj"
extension) but realized it wasn't conforming to the Z80 assembler
standard object file format.<br>

<br>

27, "Reserved name"<br>

You have tried to create a label or other name as "ASMPC".<br>

<br>

28, "Couldn't open library file"<br>

The library file was found but couldn't be opened (probably already
opened by another application resource)<br>

<br>

29, "Not a library file"<br>

Your library file is not a library file (at least is not of the correct
file format used by this assembler). Have you maybe used another
"library" file? The MPM library file could also be corrupted (at least
in the header)...<br>

<br>

30, "Environment variable not defined"<br>

The assembler reports that either the "MPM_DEFFILES" or "MPM_STDLIB"
environment variables wasn't found in the operating system.<br>

<br>

31, "Cannot include file recursively"<br>

An file was tried to be included which was already included at a
previous include level. INCLUDE "a.h" cannot contain an INCLUDE "a.h"...<br>


</body>
</html>
