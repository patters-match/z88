<!doctype html public "-//w3c//dtd html 4.0 transitional//en">

<html>

<head>

   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

   <meta name="GENERATOR" content="Mozilla/4.6 [en] (Win98; I) [Netscape]">

   <title>Standard Input-Output and the CLI</title>

</head>

<body>

<table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" >

<tr>

<th ALIGN=CENTER COLSPAN="3">Z88 Developers' Notes</th>

</tr>

<tr>

<td ALIGN=LEFT VALIGN=BOTTOM WIDTH="10%"><a href="intarith.htm">Previous</a></td>

<td ALIGN=CENTER VALIGN=BOTTOM WIDTH="80%"><a href="index.htm">Contents</a></td>

<td ALIGN=RIGHT VALIGN=BOTTOM WIDTH="10%"><a href="prfilter.htm">Next</a></td>

</tr>

</table>



<hr WIDTH="100%">

<p>



<b><font size=+1>13. Standard Input / Output and the CLI</font></b>

<br>&nbsp;

<p>The Z88 operating system has, at any one time, a standard input source

and a standard output destination. A number of calls use these standard

I/O streams:

<pre><a href='osin.htm'>OS_In</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read a character from standard input

<a href='ostin.htm'>OS_Tin</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timed read a character from standard output

<a href='osout.htm'>OS_Out</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write a character to standard output

<a href='gnsop.htm'>GN_Sop</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write a string to standard output

<a href='gnsoe.htm'>GN_Soe</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write a string at extended address to standard output

<a href='gnsip.htm'>GN_Sip</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fetch an input line using standard I/O

<a href='gnsdo.htm'>GN_Sdo</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write date to standard output</pre>

Initially standard input and output are bound to the keyboard and screen

respectively, but may be redefined to any file or device. The user may

do this via the Command Line Interpreter (CLI). CLI commands are prefixed

by a full stop and must be the first thing on the line.

<pre><i>.&lt; INFILE</i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; take input from file/device "INFILE"

<i>.> OUTFILE</i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; send output to file/device "OUTFILE"</pre>

which binds the standard input to "infile" and the standard output to "outfile".

Redirection can also be done as T-fashion, where the ordinary streams remain

in place, but copies of their contents are sent to a file or a device.

<pre><i>.T&lt; INFILE</i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; send copy of input to file/device "INFILE"

<i>.T> INFILE</i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; send copy of output to file/device "OUTFILE"</pre>

The printer output can be redirected in both ways:

<pre><i>.= PRTFILE</i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; redirect pre-filter printer output to file/device

<i>.T= PRTFILE</i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; as <i>.=</i>, but also send the output to the printer filter.</pre>

Certain keystroke operations (such as &lt;SQUARE> and &lt;DIAMOND> sequences)

have a special representation which is used when input is redirected. These

sequences are generated when input is T-redirected and can be used in ordinary

redirection to simulate the effect of the keyboard. Note that there are

some keyboard features which have no representation, such as: the CAPS

LOCK key, &lt;SHIFT> or &lt;DIAMOND> with &lt;ESC>, the effect of holding

down &lt;SHIFT> and &lt;DIAMOND> to stop output scrolling.

<pre><i>Sequence</i>&nbsp;&nbsp;&nbsp; <i>Significance



</i>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; holding down &lt;SQUARE> and pressing another key

|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; holding down &lt;DIAMON> and pressing another key

~A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pressing &lt;SQUARE> and releasing it before another keypress

~C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pressing &lt;DIAMOND> and releasing it before another keypress

|[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ESC> key

~E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ENTER> key

~S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;SHIFT> key (only generated if &lt;SHIFT> had an effect)

~I&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;INDEX> key

~M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;MENU> key

~H&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;HELP> key

~X&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;DEL> key

~U&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;UP> arrow key

~D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;DOWN> arrow key

~L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;LEFT> arrow key

~R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;RIGHT> arrow key

##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a single # (hash) character

||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a single | character

~~&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a single ~ tilde (pronounced 'tilda' or 'twiddle')</pre>

The CLI also has the following commands:

<pre>.S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; suspend the current CLI but maintain all rebindings

.D n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay for n centiseconds (if &lt;ESC> is pressed during a delay then

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subsequent delays will fail for the rest of the current CLI)

.J&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Jammer. Ignore all special sequences for the rest of the CLI (eg.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; after this command #B will generate '#B' and try and enter a BBC

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BASIC application)

.* file&nbsp;&nbsp;&nbsp;&nbsp; Invoke a new CLI file

.;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CLI comment (rest of line until CR is ignore by CLI)</pre>

NOTE: The CLI command '..' was intended to produce a single dot. This in

fact does not work. Any number of dots at the start of the line will be

ignored. One way around this bug is to use '~.' at the start of a line

to generate a full stop. Subsequent dots (ie. ones which do not appear

as the first character of the line) are treated like ordinary alpha characters.

<p>CLI files can invoke other CLI files. A CLI file is terminated when

the end of a file is reached or a suspension command is issued. CLI's can

be forcibly removed one at a time by pressing &lt;SHIFT> and &lt;ESC>,

or all current CLI's can be removed by using &lt;DIAMOND> and &lt;ESC>.

Note that &lt;DIAMOND> must be actually held down while &lt;ESC> is pressed,

ie. the usual latching operation does not apply. The CLI can be accessed

by BBC BASIC by using the *CLI command or the OSCLI command. For example,

to create a 10 second delay:

<p><tt>*CLI .D 100</tt>

<br><tt>OSCLI ("*CLI .D 100"): REM these two lines are equivalent</tt>

<p>Most CLI use will be in the form of executable files, consisting of

lines of CLI commands and text. These can be generated in PipeDream and

saved as text files. Or generated by hand and then executed. CLI files

can be executed from the FILER (using &lt;>EX command) or from BBC BASIC

using:

<p><tt>OSCLI ("*CLI .*"+fname$)</tt>

<p>where <i>fname$</i> contains the filename. Typical CLI files consist

of short sequences like:

<p><tt>.T> copyout .S</tt>

<p>The first line sends a copy of all output to the file 'copyout', and

the second line maintains this new binding on exit from the CLI file. The

binding (T-output to 'copyout') will now stay in place until the CLI is

terminated by &lt;SHIFT>&lt;ESC> to remove the current CLI (or &lt;>&lt;ESC>,

which removes all CLI's running). This situation will generally be undesirable,

because it requires user intervention, since the program cannot simulate

the effect of &lt;SHIFT> &lt;ESC>. Ideally the CLI should be avoided. Redirection

can be easily achieved in applications by using file I/O, however, if necessary

the CLI can be accessed fairly directly from an application. The operating

system call <a href='dcicl.htm'>DC_Icl</a> invokes a new CLI, and is effectively the equivalent

of BASIC's *CLI. The call <a href='dcrbd.htm'>DC_Rbd</a> is used to directly rebind streams in

the current CLI layer and can also terminate the CLI.

<p><b>Example</b>

<p>The program below starts a CLI, using <a href='dcrbd.htm'>DC_Rbd</a>, rebinds the T-output stream,

and finally closes the stream and terminates the CLI. Refer to "System

Calls Reference" for details of the calls used:

<p>

<hr WIDTH="100%">

<pre>include "#director.def"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; director and CLI call definitions

include "#stdio.def"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; standard I/O call defs. &amp; parameters

include "#fileio.def"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; standard file I/O call defs. &amp; parameters

include "#errors.def"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; error code calls and definitions</pre>

<tt>; entry point is .main</tt>

<br><tt>; on entry, (name) contains the address of a buffer which hold

a filename</tt>

<br><tt>; to be used with the CLI, and (scratch) holds the address of a

scratch</tt>

<br><tt>; buffer which need be no more than a few bytes in length</tt>

<pre>.main&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; hl, cli_string&nbsp;&nbsp;&nbsp;&nbsp; ; string to pass the CLI

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; c, 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; length

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; b, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; must be zero

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call_oz(<a href='dcicl.htm'>DC_Icl</a>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; invoke a new CLI

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; bc, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; key read to allow CLI to be processed

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call_oz(<a href='ostin.htm'>OS_Tin</a>)



&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; b, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; HL is a local address

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; hl, (name)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; filename

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; de, (scratch)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; address of scratch buffer

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; c, 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; explicit filename length

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; a, OP_OUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; open a file for output

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call_oz(<a href='gnopf.htm'>GN_Opf</a>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; open...

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jr&nbsp;&nbsp; nc, rebind

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call_oz(<a href='gnerr.htm'>GN_Err</a>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; display error in box

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ret&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; note that on exit the CLI will

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; still be active</pre>

<tt>; code to rebind standard output</tt>

<pre>.rebind&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; a, 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; T-output code

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call_oz(<a href='dcrbd.htm'>DC_Rbd</a>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; rebind to stream IX

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jr&nbsp;&nbsp; nc, continue

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call_oz(<a href='gncl.htm'>GN_Cl</a>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; something has gone badly wrong

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ret&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; attempt to close the file and exit</pre>

<tt>; write to standard output, and hence also to the file</tt>

<pre>.continue&nbsp;&nbsp; ld&nbsp;&nbsp; hl, message

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call_oz(<a href='gnsop.htm'>GN_Sop</a>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; output message to std. output and file

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; ix, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; close off CLI and file

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ld&nbsp;&nbsp; a, 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; T-output code

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call_oz(<a href='dcrbd.htm'>DC_Rbd</a>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; close file and quit CLI

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ret&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; return (ignore all errors)



.message&nbsp;&nbsp;&nbsp; defm "This should go to the file and the screen." &amp; 0

.cli_string defm ".S" &amp; 0

</pre>



<p>

<hr WIDTH="100%">

<table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" >

<tr>

<td ALIGN=LEFT VALIGN=TOP WIDTH="33%"><a href="intarith.htm">Previous</a></td>

<td ALIGN=CENTER VALIGN=TOP WIDTH="34%"><a href="index.htm">Contents</a></td>

<td ALIGN=RIGHT VALIGN=TOP WIDTH="33%"><a href="prfilter.htm">Next</a></td>

</tr>

<tr>

<td ALIGN=LEFT VALIGN=TOP WIDTH="33%">Integer arithmetic</td>

<td ALIGN=CENTER VALIGN=TOP WIDTH="34%">Standard Input / Output and the CLI</td>

<td ALIGN=RIGHT VALIGN=TOP WIDTH="33%">The Printer filter</td>

</tr>

</table>



</body>

</html>

