<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>


  
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

  
  <title>System Calls Reference</title>
</head>


<body>


<table border="0" cellpadding="0" cellspacing="0" width="100%">


  <tbody>


    <tr>


      <th colspan="3" align="center">Z88
Developers' Notes</th>


    </tr>


    <tr>


      <td align="left" valign="bottom" width="10%"><a href="index.htm">Contents</a></td>


      <td align="center" valign="bottom" width="80%">&nbsp;</td>


      <td align="right" valign="bottom" width="10%"><a href="sysref.htm">Contents&nbsp;of&nbsp;System&nbsp;Calls</a></td>


    </tr>


  
  </tbody>
</table>


<hr width="100%">
<p><b><font size="+1">OS_Epr, File Eprom
Interface</font></b>
</p>


<p><tt>RST 20H, DEFW $F006</tt>
</p>


<span style="font-family: monospace;">IN:</span><br style="font-family: monospace;">


<div style="margin-left: 40px; font-family: monospace;">A
= reason code:<br>


<br>


EP_Save = $00 &nbsp; Blow RAM file to UV Eprom <br>


EP_Load = $03 &nbsp; Copy file from File Area, as RAM file <br>


EP_Req = $06 &nbsp;&nbsp; Check for "oz" File Eprom or File
Area in slot C &nbsp;(OZ 4.2 and newer)<br>


EP_Fetch = $09 &nbsp;Copy saved/deleted file from File Area to
RAM&nbsp; &nbsp;&nbsp;&nbsp;(OZ 4.2 and newer)<br>


EP_Find = $0c &nbsp; Find active File(name) in File Area in slot C
&nbsp;&nbsp;&nbsp;&nbsp;(OZ 4.2 and newer)<br>


EP_Dir = $0f &nbsp; &nbsp;Return next filename (starting with
first) <br>


EP_First = $12 &nbsp;Return first file entry in File Area in slot C
&nbsp; &nbsp;(OZ 4.2 and newer)<br>


EP_Prev = $15 &nbsp; Return previous file entry in File Area
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (OZ 4.2 and
newer)<br>


EP_Next = $18 &nbsp; Return next file entry in File Area &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (OZ
4.2 and newer)<br>


EP_Last = $1b &nbsp; Return last file entry in File Area in slot C
&nbsp; &nbsp; (OZ 4.2 and newer)<br>


EP_TotSp = $1e &nbsp;Return amount of used file space in slot C
&nbsp; &nbsp; &nbsp; &nbsp;(OZ 4.2 and newer)<br>


EP_ActSp = $21 &nbsp;Return active file space in slot C &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;(OZ 4.2 and newer)<br>


EP_FreSp = $24 &nbsp;Return free file space in slot C &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;(OZ 4.2 and newer)<br>


EP_Count = $27 &nbsp;Return number of files in File Area slot C
&nbsp; &nbsp; &nbsp; &nbsp;(OZ 4.2 and newer)<br>


EP_Stat = $2a &nbsp; Return file entry status (active or deleted)
&nbsp; &nbsp; &nbsp;(OZ 4.2 and newer)<br>


EP_Size = $2d &nbsp; Return file size in CDE of File Entry at BHL
&nbsp; &nbsp; &nbsp;(OZ 4.2 and newer)<br>


EP_Name = $30 &nbsp; Copy File entry name to buffer at (CDE)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (OZ 4.2 and
newer)<br>


EP_Image = $33 &nbsp;Return pointer to start of file contents
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(OZ 4.2 and newer)<br>


EP_New = $36 &nbsp; &nbsp;Return pointer to future new entry in
File Area &nbsp;&nbsp;(OZ 4.2 and newer)<br>


EP_SvFl = $39 &nbsp; Save RAM file to Flash or UV Eprom to slot C
&nbsp; &nbsp; &nbsp;(OZ 4.2 and newer)<br>


EP_Delete = $3c Mark File Entry as deleted on Flash or UV Eprom
&nbsp; (OZ 4.2 and newer)<br>


EP_Format = $3f Create File Area in UV Eprom in slot 3 &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(OZ 4.2 and newer)<br>


EP_WrBlk = $42 &nbsp;Write a block of bytes to UV Eprom in slot 3
&nbsp; &nbsp; &nbsp;(OZ 4.2 and newer)<br>


<br>


</div>


<div style="margin-left: 40px;"><span style="font-family: monospace;">BC, DE, HL, IX arguments.
<br>


</span></div>


<span style="font-family: monospace;">OUT:<br style="font-family: monospace;">

</span>
<div style="margin-left: 40px;">
<span style="font-family: monospace;">Fc = 1, A = error
code.</span><br style="font-family: monospace;">


<span style="font-family: monospace;">Fc = 0, reason code
action successfully ended.</span><br style="font-family: monospace;">


</div>


<br style="font-family: monospace;">


<span style="font-family: monospace;">Registers changed
after return:</span><br style="font-family: monospace;">


<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
..BCDEHL/IXIY same</span><br style="font-family: monospace;">


<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
AF....../.... different</span><br>


<b><br>
</b>
<hr style="width: 100%; height: 2px;"><br>




<b>EP_SAVE ($00) - blow RAM file to Eprom.</b>
<pre>IN:&nbsp; BHL = pointer to filename, (B=0 means local pointer)<br><br>OUT: Fc = 0, file successfully blown on File EPROM.<br>&nbsp;&nbsp;&nbsp;&nbsp; Fc = 1:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A = RC_FAIL ($16), file couldn't be blown on EPROM.</pre>


Notes:
<blockquote>This call is equivalent to the &lt;&gt;ES
command in the FILER.
Any files on Eprom matching the filename in BHL will be marked
'deleted'.<br>


  <br>
</blockquote>
<hr style="width: 100%; height: 2px;"><br>
<b>EP_LOAD ($03) - read file from Eprom into RAM file.</b>
<pre>IN:&nbsp; BHL = pointer to filename (to be found on EPROM)<br>&nbsp;&nbsp;&nbsp;&nbsp; IX = output file handle (to store contents of file on EPROM)<br><br><br>OUT: Fc = 0, file successfully moved to RAM filing system.<br>&nbsp;&nbsp;&nbsp;&nbsp; Fc = 1:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A = RC_FAIL ($16), file EPROM not available.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A = RC_ROOM ($07), no room in filing system for data from EPROM.</pre>


Notes:<br>
<div style="margin-left: 40px;">Before calling OS_Epr and EP_LOAD you should create a
new file
with an appropriate file name, using <a href="gnopf.htm">GN_Opf</a>,
A = OP_OUT. The filename to
be searched on EPROM must not contain wildcards (the File EPROM is not
organised as the RAM filing system). This call is equivalent to the
&lt;&gt;EF
command in the FILER. You must close the output file after the data has
been copied from EPROM.<br>
</div>


  <br>
<hr style="width: 100%; height: 2px;"><br>
<b>EP_REQ ($06) -&nbsp;</b><span style="font-weight: bold;">Check for "oz" File Eprom or File
Area in slot C &nbsp; (OZ 4.2 and newer)</span><br>
<b><br>
</b>Check for "oz" File Eprom (on a conventional Eprom or on a Flash Memory)<br>
<ol>
  <li>Check for a standard "oz" File Eprom, if that fails -<br>
  </li>
  <li>Check if that slot contains an Application ROM, then check for
the Header Identifier below the application bank area. For Flash Cards,
the File Header might be on first top bank of a free 64K sector. For UV
Eproms, the File Header might be on the first top bank below the
application bank area.<br>
  </li>
  <li>If a Rom Front Dor is located in a RAM Card, then this slot is regarded as a non-valid card as a File Eprom, ie. not present.<br>
  </li>
  <li>Check for embedded 'oz' watermark inside an 'OZ' application header. If found, then this indicates that a file area is located at the top of a card above an application area or at the top of an OZ ROM.<br>
  </li>
  <ol>
    <li>A standard 'oz' header is recognized by the top two watermark bytes in the top bank of the file area (either typically at the top of the card, in modulus 64K sectors in Flash Cards or&nbsp; modulus 16K banks on traditional EPROM's. The complete header has the following format:<br>
      <div style="margin-left: 40px;"><span style="font-family: monospace;">&nbsp;&nbsp; ------------------------------------------------------------------------------</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; $3FC0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $00's until</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; $3FF7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $01</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; $3FF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 byte random id</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; $3FFC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; size of card in banks (2=32K, 8=128K, 16=256K, 64=1Mb)</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;
$3FFD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sub-type: $7E, $7C, $7A for
UV 32K, 128K &amp; 256K cards. $77, $6F for Intel and Amd Flash</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; $3FFE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'o'</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; $3FFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'z' (file eprom identifier, lower case 'oz')</span><br>
      <span style="font-family: monospace;">&nbsp;&nbsp; ------------------------------------------------------------------------------</span><br>
      </div>
      <br>
      <div style="margin-left: 40px;">&nbsp;&nbsp; in hex dump (example):<br>
      <br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; 00003fc0h: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ; ................</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; 00003fd0h: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ; ................</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; 00003fe0h: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ; ................</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; 00003ff0h: 00 00 00 00 00 00 00 01 73 D1 4B 3C 02 7E 6F 7A ; .........s?&lt;.~oz</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; ------------------------------------------------------------------------------<br>
      </span></div>
    </li>
    <li>A sub-standard 'oz' header is recognized at offset $3FEE inside
an application 'OZ' header that is always placed at the top of the
card, with the following format:<br>
    </li>
  </ol>
</ol>
<div style="margin-left: 80px;">&nbsp;&nbsp; Application Front DOR:<br>
<br>
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FC0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Link to
parent</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FC3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Link to
brother - this may point to the HELP front DOR</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FC6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x x
x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Link to
son - this points to the first application DOR</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FC9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DOR type, ROM Front DOR</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FCA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DOR length</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FCB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
'N'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Key for name field (DT_NAM)</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FCC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Length of name and terminator</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FCD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'APPL',
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL-terminated name</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FD2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$FF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DOR terminator</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; Optional file area at top card, above application area:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FEC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Size of file area in banks, eg. $02 for a 32K size</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
64K Reclaim Sector (0=not used)</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FEE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
'oz'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Application/ROM Card holds file area</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
@0xxxxxxx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Low byte of card ID</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FF9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
@0xxxxxxx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; High byte of card ID</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FFA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
@0000xxxx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 bit country code</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FFB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Marks external application</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FFC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Size of card in banks, eg. $02 for a 32K card</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FFD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Subtype of card - future expansion</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;
$3FFE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
'OZ'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Card holds applications</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; ------------------------------------------------------------------------------</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; in hex dump (example):</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; 00003fc0h: 00 00 00 00 00 00 48 25 08 13 08 4E 05 41 50 50 ; ......H%...N.APP</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; 00003fd0h: 4C 00 FF 00 00 00 00 00 00 00 00 00 00 00 00 00 ; L..............</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; 00003fe0h: 00 00 00 00 00 00 00 00 00 00 00 00 14 00 6F 7A ; ..............oz</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; 00003ff0h: 00 00 00 00 00 00 00 00 54 43 4C 81 20 00 4F 5A ; ........TCL .OZ</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; ------------------------------------------------------------------------------</span><br style="font-family: monospace;">
<br>
</div>
On partial success, if a Header is not found, Fz = 0 and the returned
BHL pointer indicates that the card might hold a file area, beginning
at this location.<br>
If the routine returns Fz = 1, it's an identified File Area Header (pointing to 64 byte header in the top of bank B).<br>
<br>
<span style="font-family: monospace;">Register parameters:</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">In:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; C = slot number (0, 1, 2 or 3)</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">Out:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; Success, File Area (or potential) available:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fc = 0,</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
BHL = pointer to File Header for slot C (B = absolute bank of slot).</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(or pointer to free space in potential new File Area).</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; C = size of File Eprom Area in 16K banks</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fz = 1, File Header found</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
A = "oz" File Eprom sub type</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
D = size of card in 16K banks (0 - 64)</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fz = 0, File Header not found</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A undefined</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D undefined</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; Failure:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fc = 1,</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; C = C(in)</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
A = RC_ONF (File Eprom Card/Area not available; possibly no card in
slot)</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
A = RC_ROOM (No room for File Area; all banks used for applications)</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">Registers changed after return:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; .....E../IXIY same</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; AFBCD.HL/.... different</span><br style="font-family: monospace;">
<br>
<hr style="width: 100%; height: 2px;"><br>
<span style="font-weight: bold;">EP_Fetch ($09) -&nbsp;Copy saved/deleted file from File Area to
RAM&nbsp; &nbsp;&nbsp;&nbsp;(OZ 4.2 and newer)<br>
<br>
</span>Fetch file (image) from File Eprom Card, identified by File
Entry at BHL (B=00h-FFh embedded slot mask, HL=0000h-3FFFh bank offset)
and store it into<br>
an open file (enabled for writing) in the RAM file system (using the IX handle).<br>
<br>
The application is responsible for opening/creating a RAM file, then
using this library routine to transfer the contents from the File Eprom
to the RAM file system, and then finally close the new RAM file.<br>
<br>
<span style="font-family: monospace;">IN:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; IX = handle of file stream (opened previously with GN_Opf, A=OP_OUT)</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; BHL = pointer to Eprom File Entry (bits 7,6 of B is the slot mask)</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">OUT:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; Fc = 0,</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File Image transferred successfully to RAM file.</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; Fc = 1,</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A = RC_ONF, File Eprom or File Entry was not found in slot</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A = RC_xxx, I/O error during saving process.</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">Registers changed after return:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; ..BCDEHL/IXIY same</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; AF....../.... different</span><br>
<br>
<hr style="width: 100%; height: 2px;"><span style="font-weight: bold;"><br>
EP_Find ($0C) -&nbsp;Find active File(name) in File Area in slot C
&nbsp;&nbsp;&nbsp;&nbsp;(OZ 4.2 and newer)</span><br>
<br>
<span style="font-family: monospace;">IN:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; C = slot number of File Eprom (Area)</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; DE = pointer to null-terminated filename to be searched for.</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The filename is excl. device name and must begin with '/'.</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">OUT:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; Fc = 0, File Eprom available</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fz = 1, File Entry found.</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BHL = pointer to File Entry in card at slot</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fz = 0, No file were found on the File Eprom.</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BHL = pointer to free byte on File Eprom in slot</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; Fc = 1,</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A = RC_Onf</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File Eprom was not found at slot C</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">Registers changed after return:</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; A..CDE../IXIY same</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp; .FB...HL/.... different</span><br style="font-family: monospace;">
<br>
<hr style="width: 100%; height: 2px;"><br>
<b>EP_DIR ($0F) - fetch filename from Eprom:</b>
<pre>IN:&nbsp; BHL = pointer to store returned filename (B=0 means local pointer).<br><br>OUT: Fc = 0:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Filename returned at (HL), null-terminated.<br>&nbsp;&nbsp;&nbsp;&nbsp; Fc = 1:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A = RC_EOF ($09), no more filenames on File EPROM.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A = RC_FAIL ($16), File EPROM not available.</pre>


Notes:
<br>
<div style="margin-left: 40px;">The first EPR_DIR call will return the first file
name, if
available. Subsequent calls will return the next filenames in
chronological
order (as the files were stored on EPROM). It is necessary to read all
file names to the end, if you want to re-read the filenames from start
at a later time. The buffer to receive the filenames from EPR_DIR must
be sufficiently large, e.g. 128 bytes. The FILER uses this to&nbsp;display
all available filenames on EPROM. Filenames never contains RAM device
references,
but always reflect the complete path from the filing system (when blown
to EPROM). Old 'deleted' files are not reflected in the list of
filenames.<br>
</div>


  



</body>
</html>
